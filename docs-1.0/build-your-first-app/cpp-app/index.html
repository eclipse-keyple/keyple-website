<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Wowchemy 5.3.0 for Hugo">
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap">
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" media=print onload="this.media='all'">
<meta name=description content="This quick start describes how to create a ready-to-execute C++ command-line application that runs a simple transaction based on a Calypso portable object involving two smart card readers.">
<link rel=alternate hreflang=en-us href=https://keyple.org/docs-1.0/build-your-first-app/cpp-app/>
<meta name=theme-color content="#1D87BB">
<link rel=stylesheet href=../../../css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css media=print onload="this.media='all'">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin=anonymous media=print onload="this.media='all'">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/darcula.min.css crossorigin=anonymous title=hl-light media=print onload="this.media='all'">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/darcula.min.css crossorigin=anonymous title=hl-dark media=print onload="this.media='all'" disabled>
<link rel=stylesheet href=../../../css/wowchemy.b800eb4087fa911f139076a8a1cc4d9d.css>
<script>(function(b,d,e,a,g){b[a]=b[a]||[],b[a].push({'gtm.start':(new Date).getTime(),event:'gtm.js'});var f=d.getElementsByTagName(e)[0],c=d.createElement(e),h=a!='dataLayer'?'&l='+a:'';c.async=!0,c.src='https://www.googletagmanager.com/gtm.js?id='+g+h,f.parentNode.insertBefore(c,f)})(window,document,'script','dataLayer','GTM-5WLCZXC')</script>
<link rel=manifest href=../../../manifest.webmanifest>
<link rel=icon type=image/png href=../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_3.png>
<link rel=apple-touch-icon type=image/png href=../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_180x180_fill_lanczos_center_3.png>
<link rel=canonical href=https://keyple.org/docs-1.0/build-your-first-app/cpp-app/>
<meta property="twitter:card" content="summary">
<meta property="og:site_name" content="Eclipse Keyple">
<meta property="og:url" content="https://keyple.org/docs-1.0/build-your-first-app/cpp-app/">
<meta property="og:title" content="Build your first C++ application | Eclipse Keyple">
<meta property="og:description" content="This quick start describes how to create a ready-to-execute C++ command-line application that runs a simple transaction based on a Calypso portable object involving two smart card readers."><meta property="og:image" content="https://keyple.org/media/logo.svg">
<meta property="twitter:image" content="https://keyple.org/media/logo.svg"><meta property="og:locale" content="en-us">
<meta property="article:modified_time" content="2021-10-26T18:09:46+02:00">
<title>Build your first C++ application | Eclipse Keyple</title>
</head>
<body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=a649192166df002a8bbc7d300bde003b>
<script src=../../../js/wowchemy-init.min.da42964e270e05a6063fbca894d7ccff.js></script>
<aside class=search-modal id=search>
<div class=container>
<section class=search-header>
<div class="row no-gutters justify-content-between mb-3">
<div class=col-6>
<h1>Search</h1>
</div>
<div class="col-6 col-search-close">
<a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a>
</div>
</div>
<div id=search-box>
<input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...>
</div>
</section>
<section class=section-search-results>
<div id=search-hits>
</div>
</section>
</div>
</aside>
<div class=page-header>
<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main>
<div class=container-xl>
<div class="d-none d-lg-inline-flex">
<a class=navbar-brand href=../../../><img src=../../../media/logo.svg alt="Eclipse Keyple"></a>
</div>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span>
</button>
<div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
<a class=navbar-brand href=../../../><img src=../../../media/logo.svg alt="Eclipse Keyple"></a>
</div>
<div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content>
<ul class="navbar-nav d-md-inline-flex">
<li class="nav-item dropdown">
<a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple®</span><span class=caret></span>
</a>
<div class=dropdown-menu>
<a class=dropdown-item href=../../../what-is-keyple/overview/><span>Overview</span></a>
<a class=dropdown-item href=../../../what-is-keyple/why-trust/><span>Why trust Eclipse Keyple®?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=../../../#adopters><span>Who is using Eclipse Keyple®?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/what-is-calypso/><span>What is Calypso®?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=../../../#news><span>News</span></a>
</div>
</li>
<li class=nav-item>
<a class=nav-link href=../../../learn/overview><span>Learn</span></a>
</li>
<li class="nav-item dropdown">
<a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Components</span><span class=caret></span>
</a>
<div class=dropdown-menu>
<a class=dropdown-item href=../../../components-java/overview/><span>Java implementation v2+</span></a>
<a class=dropdown-item href=../../../components-cpp/overview/><span>C++ implementation v2+</span></a>
<a class=dropdown-item href=../../../><span> </span></a>
<a class=dropdown-item href=../../../components-java-1.0/><span>Java implementation v1.0 (deprecated)</span></a>
<a class=dropdown-item href=../../../components-cpp-0.9/><span>C++ implementation v0.9 (deprecated)</span></a>
</div>
</li>
<li class="nav-item dropdown">
<a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Community</span><span class=caret></span>
</a>
<div class=dropdown-menu>
<a class=dropdown-item href=../../../community/contributing/><span>Contributing</span></a>
<a class=dropdown-item href=../../../community/roadmap/><span>Roadmap</span></a>
<a class=dropdown-item href=../../../projects-dashboard/><span>Projects dashboard</span></a>
<a class=dropdown-item href="https://sonarcloud.io/organizations/eclipse/projects?search=keyple&sort=-analysis_date"><span>Code quality dashboard</span></a>
<a class=dropdown-item href=https://projects.eclipse.org/projects/iot.keyple/><span>Eclipse Foundation Keyple page</span></a>
<a class=dropdown-item href=https://accounts.eclipse.org/mailing-list/keyple-dev/><span>Mailing list</span></a>
<a class=dropdown-item href=https://github.com/eclipse/keyple/><span>GitHub home repository</span></a>
</div>
</li>
<li class="nav-item dropdown">
<a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>External resources</span><span class=caret></span>
</a>
<div class=dropdown-menu>
<a class=dropdown-item href=../../../external-resources/external-add-ons/><span>External add-ons</span></a>
<a class=dropdown-item href=../../../external-resources/compliant-terminals/><span>Compliant terminals</span></a>
<a class=dropdown-item href=../../../external-resources/support-and-training-companies/><span>Support & training companies</span></a>
</div>
</li>
</ul>
</div>
<ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
<li class=nav-item>
<a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a>
</li>
</ul>
</div>
</nav>
</div>
<div class=page-body>
<div class="container-fluid docs">
<div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 docs-sidebar">
<form class="docs-search d-flex align-items-center">
<button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<div class=d-flex>
<span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
Build your first app
</span>
<span><i class="fas fa-chevron-down"></i></span>
</div>
</button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span>
</button>
</form>
<nav class="collapse docs-links" id=docs-nav>
<ul class="nav docs-sidenav">
<li><a href=../../../docs-1.0/>Overview</a></li>
<div class=docs-toc-item>
<a class=docs-toc-link href=../../../docs-1.0/build-your-first-app/>Build your first app</a>
<ul class="nav docs-sidenav">
<li><a href=../../../docs-1.0/build-your-first-app/java-app/>Java</a></li>
<li><a href=../../../docs-1.0/build-your-first-app/android-app/>Android</a></li>
<li class=active><a href=../../../docs-1.0/build-your-first-app/cpp-app/>C++</a></li>
</ul>
</div>
<div class=docs-toc-item>
<a class=docs-toc-link href=../../../docs-1.0/developer-guide/>Developer guides</a>
<ul class="nav docs-sidenav">
<li><a href=../../../docs-1.0/developer-guide/common-concepts/>Common concepts</a></li>
<li><a href=../../../docs-1.0/developer-guide/standalone-application/>Standalone application</a></li>
<li><a href=../../../docs-1.0/developer-guide/distributed-application/>Distributed application</a></li>
<li><a href=../../../docs-1.0/developer-guide/calypso-application/>Calypso application</a></li>
<li><a href=../../../docs-1.0/developer-guide/create-plugin/>Create a plugin</a></li>
<li><a href=../../../docs-1.0/developer-guide/create-extension/>Create an extension</a></li>
<li><a href=../../../docs-1.0/developer-guide/upgrade/>Upgrade Keyple</a></li>
</ul>
</div>
<div class=docs-toc-item>
<a class=docs-toc-link href=../../../docs-1.0/api-reference/>API reference</a>
<ul class="nav docs-sidenav">
<li><a href=../../../docs-1.0/api-reference/java-api/>Java</a></li>
<li><a href=../../../docs-1.0/api-reference/cpp-api/>C++</a></li>
</ul>
</div>
<div class=docs-toc-item>
<a class=docs-toc-link href=../../../docs-1.0/architecture/>Architecture</a>
<ul class="nav docs-sidenav">
<li><a href=../../../docs-1.0/architecture/keyple-global/>Global Solution</a></li>
<li><a href=../../../docs-1.0/architecture/keyple-core/>Keyple Core</a></li>
<li><a href=../../../docs-1.0/architecture/keyple-calypso/>Keyple Calypso</a></li>
</ul>
</div>
</ul>
</nav>
</div>
<div class="d-none d-xl-block col-xl-2 docs-toc">
<ul class="nav toc-top">
<li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li>
</ul>
<nav id=TableOfContents>
<ul>
<li><a href=#lets-code>Let&rsquo;s code</a>
<ul>
<li><a href=#create-the-class-skeleton>Create the class skeleton</a></li>
<li><a href=#configure-the-pcsc-plugin-and-the-readers>Configure the PC/SC plugin and the readers</a></li>
<li><a href=#select-the-calypso-sam>Select the Calypso SAM</a></li>
<li><a href=#select-the-calypso-po>Select the Calypso PO</a></li>
<li><a href=#open-the-calypso-secure-session>Open the Calypso secure session</a></li>
<li><a href=#close-the-calypso-secure-session>Close the Calypso secure session</a></li>
</ul>
</li>
<li><a href=#cmake-build>CMake build</a></li>
<li><a href=#run>Run</a></li>
<li><a href=#faq>FAQ</a>
<ul>
<li></li>
</ul>
</li>
</ul>
</nav>
</div>
<main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main>
<article class=article>
<div class=docs-article-container>
<h1>Build your first C++ application</h1>
<div class=article-style>
<div class="alert alert-warning">
<div>
Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version.
</div>
</div>
<p>This quick start describes how to create a ready-to-execute C++
command-line application that runs a simple transaction based on
a Calypso portable object (PO) involving two smart card readers.</p>
<div class="alert alert-note">
<div>
The demonstration application created for this quick start requires a
Calypso PO (contactless smart card, mobile phone with contactless
communication) and a Calypso Secure Access Module (SAM).
</div>
</div>
<p>We will use three main components of Keyple:</p>
<ul>
<li><a href=https://keyple.org/components-cpp-0.9/core/>Keyple Core</a>
which is the base component to which all the others refer,</li>
<li><a href=https://keyple.org/components-cpp-0.9/plugins/pcsc/>Keyple PC/SC plugin</a>
to provide the ability to manage PC/SC readers,</li>
<li><a href=https://keyple.org/components-cpp-0.9/extensions/calypso/>Keyple Calypso extension</a>
to handle the commands sent to the Calypso PO and the Calypso SAM.</li>
</ul>
<p>In this guide CMake is used as build automation tool.</p>
<p>The example can run on any machine: Linux, Windows and macOS. If not installed in your machine, you
will need to download :</p>
<ul>
<li>CMake 2.8 or newer <a href=https://cmake.org/install/ target=_blank rel=noopener>(download)</a></li>
<li>GCC / CLang / MSVC compiler</li>
</ul>
<hr>
<h2 id=lets-code>Let&rsquo;s code</h2>
<p>Now let&rsquo;s see step by step how to create in one single class the
elements that allow a certified reading of data through a Calypso secure
session.</p>
<p>In a real ticketing application, the organization of the code would
probably be different, but the point here is to show how Keyple makes it
possible to perform very simply operations that normally require a
quantity of code and knowledge that far exceeds what is implemented
here.</p>
<p>You can either progressively copy each of the small portions of code
that follow or copy the whole class at the bottom of this page.</p>
<h3 id=create-the-class-skeleton>Create the class skeleton</h3>
<p>Copy the source code below in a new C++ Class named
DemoPoAuthentication.</p>
<pre><code class=language-cpp>/* Common */
#include &quot;IllegalStateException.h&quot;
#include &quot;LoggerFactory.h&quot;

/* Core */
#include &quot;ByteArrayUtil.h&quot;
#include &quot;SeCommonProtocols.h&quot;
#include &quot;SeSelector.h&quot;
#include &quot;SeSelection.h&quot;
#include &quot;SeProxyService.h&quot;

/* PCSC */
#include &quot;PcscPluginFactory.h&quot;
#include &quot;PcscProtocolSetting.h&quot;
#include &quot;PcscReader.h&quot;

/* Calypso */
#include &quot;CalypsoPo.h&quot;
#include &quot;CalypsoSam.h&quot;
#include &quot;ElementaryFile.h&quot;
#include &quot;PoSecuritySettings.h&quot;
#include &quot;PoSelectionRequest.h&quot;
#include &quot;PoSelector.h&quot;
#include &quot;PoTransaction.h&quot;
#include &quot;SamRevision.h&quot;
#include &quot;SamSelector.h&quot;
#include &quot;SamSelectionRequest.h&quot;

using namespace keyple::calypso::command::po;
using namespace keyple::calypso::command::po::builder;
using namespace keyple::calypso::command::po::parser;
using namespace keyple::calypso::command::sam;
using namespace keyple::calypso::transaction;
using namespace keyple::common;
using namespace keyple::common::exception;
using namespace keyple::core::command::exception;
using namespace keyple::core::selection;
using namespace keyple::core::seproxy;
using namespace keyple::core::seproxy::event;
using namespace keyple::core::seproxy::exception;
using namespace keyple::core::seproxy::message;
using namespace keyple::core::seproxy::protocol;
using namespace keyple::core::util;
using namespace keyple::plugin::pcsc;

int main(int argv, char **args)
{
    // ...

    return 0;
}
</code></pre>
<h3 id=configure-the-pcsc-plugin-and-the-readers>Configure the PC/SC plugin and the readers</h3>
<p>The first step to use Keyple is to initialize the plugin and smart card readers.</p>
<p>In this snippet the PC/SC plugin is registered to the SmartCardService.</p>
<p>Two readers needs to be connected to the local machine. Replace
&ldquo;PO_READER_NAME&rdquo; and &ldquo;SAM_READER_NAME&rdquo; with the name of the USB readers.</p>
<p>If you don&rsquo;t know the names of the readers, read how to find them in the <a href=#faq>FAQ</a>.</p>
<pre><code class=language-cpp>/* ... */
/* PO Reader name */
const std::string PO_READER_NAME = &quot;XXX&quot;;

/* SAM Reader name */
const std::string SAM_READER_NAME = &quot;XXX&quot;;

/* Get the instance of the SeProxyService (Singleton pattern) */
SeProxyService&amp; seProxyService = SeProxyService::getInstance();

/* Register the PcscPlugin with SeProxyService, get the corresponding generic ReaderPlugin */
auto pluginFactory = std::make_shared&lt;PcscPluginFactory&gt;();
std::shared_ptr&lt;ReaderPlugin&gt; readerPlugin = seProxyService.registerPlugin(pluginFactory);

/* Get the PO reader */
std::shared_ptr&lt;SeReader&gt; poReader = readerPlugin-&gt;getReader(PO_READER_NAME);

/* Configure the PO reader parameters */
poReader-&gt;setParameter(PcscReader::SETTING_KEY_PROTOCOL, PcscReader::SETTING_PROTOCOL_T1);

/* Get a SAM reader */
std::shared_ptr&lt;SeReader&gt; samReader = readerPlugin-&gt;getReader(SAM_READER_NAME);

/* Configure the SAM reader parameters */
samReader-&gt;setParameter(PcscReader::SETTING_KEY_PROTOCOL, PcscReader::SETTING_PROTOCOL_T0);

/*
 * PC/SC card access mode:
 *
 * The SAM is left in the SHARED mode (by default) to avoid automatic resets due to the limited
 * time between two consecutive exchanges granted by Windows.
 *
 * This point will be addressed in a coming release of the Keyple PcSc reader plugin.
 *
 * The PO reader is set to EXCLUSIVE mode to avoid side effects (on OS Windows 8+) during the
 * selection step that may result in session failures.
 *
 * See KEYPLE-CORE.PC.md file to learn more about this point.
 *
 */
samReader-&gt;setParameter(PcscReader::SETTING_KEY_MODE, PcscReader::SETTING_MODE_SHARED);
poReader-&gt;setParameter(PcscReader::SETTING_KEY_MODE, PcscReader::SETTING_MODE_SHARED);

/* Set the PO reader protocol flag */
poReader-&gt;addSeProtocolSetting(
    SeCommonProtocols::PROTOCOL_ISO14443_4,
    PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_ISO14443_4]);
poReader-&gt;addSeProtocolSetting(
    SeCommonProtocols::PROTOCOL_B_PRIME,
    PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_B_PRIME]);
samReader-&gt;addSeProtocolSetting(
    SeCommonProtocols::PROTOCOL_ISO7816_3,
    PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_ISO7816_3]);

/* ... */
</code></pre>
<h3 id=select-the-calypso-sam>Select the Calypso SAM</h3>
<p>Before executing a transaction each smart card should be selected. The
next step is the selection of the Calypso SAM resulting in a
CalypsoSam object.</p>
<p>It is then combined with the SAM reader to form the SAM resource needed
later within the transaction service.</p>
<pre><code class=language-cpp>/* ... */

/* Prepare the selector to ensure the correct SAM is used */
auto selector = SamSelector::builder()-&gt;samRevision(SamRevision::AUTO).build();
auto samSelector = std::dynamic_pointer_cast&lt;SamSelector&gt;(selector);

/* Make the SAM selection */
SeSelection samSelection;
auto samSelectionRequest = std::make_shared&lt;SamSelectionRequest&gt;(samSelector);
auto abstractSamSelectionRequest =
    std::reinterpret_pointer_cast&lt;AbstractSeSelectionRequest&lt;AbstractApduCommandBuilder&gt;&gt;(samSelectionRequest);
samSelection.prepareSelection(abstractSamSelectionRequest);
std::shared_ptr&lt;CalypsoSam&gt; calypsoSam;

if (samReader-&gt;isSePresent()) {
    std::shared_ptr&lt;SelectionsResult&gt; selectionsResult = samSelection.processExplicitSelection(samReader);
    if (selectionsResult-&gt;hasActiveSelection()) {
        calypsoSam = std::dynamic_pointer_cast&lt;CalypsoSam&gt;(selectionsResult-&gt;getActiveMatchingSe());
    } else {
        throw IllegalStateException(&quot;SAM matching failed!&quot;);
    }
} else {
    throw IllegalStateException(&quot;No SAM is present in the reader &quot; + samReader-&gt;getName());
}

/* Associate the calypsoSam and the samReader to create the samResource */
auto samResource = std::make_shared&lt;SeResource&lt;CalypsoSam&gt;&gt;(samReader, calypsoSam);

/* ... */
</code></pre>
<h3 id=select-the-calypso-po>Select the Calypso PO</h3>
<p>1st PO exchange:</p>
<p>The Calypso PO selection is made using the portable object application&rsquo;s AID
and results in a CalypsoPo object that will contain all the information extracted
from the Calypso PO all along the transaction.</p>
<pre><code class=language-cpp>/* Prepare a Calypso PO selection */
SeSelection seSelection;

/* Keyple test kit profile 1, Application 2 */
const std::string AID = &quot;315449432E49434131&quot;;

/*
 * Setting of an AID based selection of a Calypso Revision 3.1 PO
 *
 * Select the first application matching the selection AID whatever the card communication
 * protocol
 * Keep the logical channel open after the selection
 *
 * Calypso selection: configures a PoSelectionRequest with all the desired attributes to
 * make the selection and read additional information afterwards
 */
 auto aidSelector = SeSelector::AidSelector::builder()-&gt;aidToSelect(AID).build();
auto seSelector = PoSelector::builder()-&gt;aidSelector(aidSelector) /* The application identifier
                                         to indicate if an invalidated PO should be accepted
                                         or not */
                                        .invalidatedPo(PoSelector::InvalidatedPo::REJECT)
                                        .build();
auto poSelector = std::dynamic_pointer_cast&lt;PoSelector&gt;(seSelector);
auto poSelectionRequest = std::make_shared&lt;PoSelectionRequest&gt;(poSelector);


/* Add the selection case to the current selection (we could have added other cases) */
auto abstractPoSelectionRequest =
    std::reinterpret_pointer_cast&lt;AbstractSeSelectionRequest&lt;AbstractApduCommandBuilder&gt;&gt;(poSelectionRequest);
seSelection.prepareSelection(abstractPoSelectionRequest);

if (poReader-&gt;isSePresent()) {
    try {
        // Actual PO communication: operate through a single request the Calypso PO selection
        std::shared_ptr&lt;CalypsoPo&gt; calypsoPo =
            std::dynamic_pointer_cast&lt;CalypsoPo&gt;(
                seSelection.processExplicitSelection(poReader)-&gt;getActiveMatchingSe());
        /* ... */
    } catch (const Exception&amp; e) {
    }
/* ... */
</code></pre>
<h3 id=open-the-calypso-secure-session>Open the Calypso secure session</h3>
<p>2nd PO exchange :</p>
<p>The secure session opening operated by the PoTransaction service is
combined with the reading of the environment file (SFI=07h).</p>
<p>The mutual authentication process between Calypso PO and Calypso SAM is initiated transparently.</p>
<pre><code class=language-cpp>/* Prepare the security settings used during the Calypso transaction */
auto poSecuritySettings = std::make_shared&lt;PoSecuritySettings::PoSecuritySettingsBuilder&gt;(samResource)-&gt;build();

/* Create a PoTransaction object to manage the Calypso transaction */
auto poTransaction = std::make_shared&lt;PoTransaction&gt;(
                            std::make_shared&lt;SeResource&lt;CalypsoPo&gt;&gt;(poReader, calypsoPo),
                            poSecuritySettings);

const uint8_t RECORD_NUMBER_1 = 1;
const uint8_t SFI_Environment = 0x07;

/* Read the Environment file at the Session Opening (we could have added other commands) */
poTransaction-&gt;prepareReadRecordFile(
        SFI_Environment, /* The sfi to select */
        RECORD_NUMBER_1);

/* Open Session with the debit key */
poTransaction-&gt;processOpening(PoTransaction::SessionSetting::AccessLevel::SESSION_LVL_DEBIT);

/* Get the Environment data */
std::shared_ptr&lt;ElementaryFile&gt; efEnvironment = calypsoPo-&gt;getFileBySfi(SFI_Environment);
const std::string environmentLog = ByteArrayUtil::toHex(efEnvironment-&gt;getData()-&gt;getContent());

/* ... */
</code></pre>
<h3 id=close-the-calypso-secure-session>Close the Calypso secure session</h3>
<p>3rd PO exchange:</p>
<p>Simply close the Calypso secure session</p>
<p>The mutual authentication is finalized, it includes the authentication
of the data in the read file.</p>
<p>Note: any technical, crytographic or content-related incident in the Calypso PO
would be signalled by an exception and would interrupt the thread of
execution.</p>
<pre><code class=language-cpp>/* Schedule the closure of the channel with the PO after the closing of the secure session */
poTransaction-&gt;prepareReleasePoChannel();

/* Perform the closing of the Calypso Secure Session */
poTransaction-&gt;processClosing();

/* ... */
</code></pre>
<p>Find the complete code source <a href=#full-code>below</a>.</p>
<hr>
<h2 id=cmake-build>CMake build</h2>
<p>Create a CMakeLists.txt file as follows:</p>
<pre><code class=language-cpp>#
# Copyright (c) 2020 Calypso Networks Association https://www.calypsonet-asso.org/
#
# All rights reserved. This program and the accompanying materials are made available under the
# terms of the Eclipse Public License version 2.0 which accompanies this distribution, and is
# available at https://www.eclipse.org/org/documents/epl-2.0/EPL-2.0.html
#

CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

SET(CMAKE_LEGACY_CYGWIN_WIN32 0)
SET(CMAKE_MACOSX_RPATH 1)
SET(CMAKE_CXX_STANDARD 11)

SET(CMAKE_C_COMPILER_WORKS 1)
SET(CMAKE_CXX_COMPILER_WORKS 1)

PROJECT(KeypleDemo)

SET(KEYPLE_SOURCE_DIR &quot;&lt;path_to_keyple_repos&gt;&quot;)

INCLUDE_DIRECTORIES(
        ${CMAKE_CURRENT_SOURCE_DIR}

        # Core
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/command
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/command/exception
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/selection
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/seproxy
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/seproxy/event
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/seproxy/exception
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/seproxy/message
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/seproxy/protocol
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/util
        ${KEYPLE_SOURCE_DIR}/component/keyple-core/src/main/util/bertlv

        # Plugin
        ${KEYPLE_SOURCE_DIR}/component/keyple-plugin/pcsc/src/main

        # Common
        ${KEYPLE_SOURCE_DIR}/component/keyple-common/src/main
        ${KEYPLE_SOURCE_DIR}/component/keyple-common/src/main/exception

        # Calypso
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/command
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/command/po
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/command/po/builder
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/command/po/parser
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/command/sam
        ${KEYPLE_SOURCE_DIR}/component/keyple-calypso/src/main/transaction

        # pcsc (Linux / macOS)
        /usr/include/PCSC
)

IF(WIN32)
        SET(CMAKE_FIND_LIBRARY_PREFIXES &quot;&quot;)
        SET(CMAKE_FIND_LIBRARY_SUFFIXES &quot;.dll&quot;)
        SET(CMAKE_BUILD_DIRECTORY &quot;${CMAKE_CURRENT_BINARY_DIR}&quot;)
        SET(WINSCARD winscard.lib)
ENDIF(WIN32)

IF(APPLE)
        SET(CMAKE_FIND_LIBRARY_PREFIXES &quot;lib&quot;)
        SET(CMAKE_FIND_LIBRARY_SUFFIXES &quot;.dylib&quot;)
        SET(CMAKE_BUILD_DIRECTORY &quot;${CMAKE_CURRENT_BINARY_DIR}&quot;)
        SET(WINSCARD &quot;-framework PCSC&quot;)
ENDIF(APPLE)

IF(UNIX)
        SET(SPEC_LIBS pthread pcsclite rt)
ENDIF(UNIX)

IF(APPLE)
        SET(SPEC_LIBS pthread)
ENDIF(APPLE)

ADD_EXECUTABLE(
        demo_po_authentication

        ${CMAKE_CURRENT_SOURCE_DIR}/main.cpp
)

TARGET_LINK_DIRECTORIES(demo_po_authentication PUBLIC ${CMAKE_CURRENT_SOURCE_DIR}/build)
TARGET_LINK_LIBRARIES(demo_po_authentication keyplecommon keyplepluginpcsc keyplecore keyplecalypso ${SPEC_LIBS})
</code></pre>
<p>Now build the demo code:</p>
<pre><code class=language-bash>mkdir build
cd build
cmake ..
make
</code></pre>
<hr>
<h2 id=run>Run</h2>
<ol>
<li>Connect two USB PC/SC Readers.</li>
<li>Insert the Calypso SAM in the SAM reader.</li>
<li>Insert the Calypso PO in the PO reader.</li>
<li>Run the application.</li>
</ol>
<hr>
<h2 id=faq>FAQ</h2>
<p><strong>How do I find out the names of the readers?</strong></p>
<p>If you don’t know the reader name, several options:</p>
<ul>
<li>run the application in debug mode and get the reader name in plugin variable</li>
<li>run &lsquo;pcsctest&rsquo; (macOS)</li>
<li>run &lsquo;pcsc_scan&rsquo; (Linux)</li>
</ul>
<p>Identify which reader will be the PO (contactless) reader and the SAM
(contact) reader and replace <code>PO_READER_NAME</code> and
<code>SAM_READER_NAME</code> with their values.</p>
<p><strong>How to activate the Keyple&rsquo;s logs?</strong></p>
<p>Logs are automatically activated but log level can be dynamically changed by a simple call to the
Logger::setLevel() function. Default value is Logger::Level::logDebug.</p>
<pre><code class=language-cpp>class DemoPoAuthentication final {};
const std::shared_ptr&lt;Logger&gt; logger = LoggerFactory::getLogger(typeid(DemoPoAuthentication));
logger-&gt;setLoggerLevel(Logger::Level::logError);
</code></pre>
<h4 id=full-code>Full code</h4>
<p>Here is the complete code of this quick start in one single block.</p>
<pre><code class=language-cpp>/**************************************************************************************************
 * Copyright (c) 2020 Calypso Networks Association                                                *
 * https://www.calypsonet-asso.org/                                                               *
 *                                                                                                *
 * See the NOTICE file(s) distributed with this work for additional information regarding         *
 * copyright ownership.                                                                           *
 *                                                                                                *
 * This program and the accompanying materials are made available under the terms of the Eclipse  *
 * Public License 2.0 which is available at http://www.eclipse.org/legal/epl-2.0                  *
 *                                                                                                *
 * SPDX-License-Identifier: EPL-2.0                                                               *
 **************************************************************************************************/

/* Common */
#include &quot;IllegalStateException.h&quot;
#include &quot;LoggerFactory.h&quot;

/* Core */
#include &quot;ByteArrayUtil.h&quot;
#include &quot;SeCommonProtocols.h&quot;
#include &quot;SeSelector.h&quot;
#include &quot;SeSelection.h&quot;
#include &quot;SeProxyService.h&quot;

/* PCSC */
#include &quot;PcscPluginFactory.h&quot;
#include &quot;PcscProtocolSetting.h&quot;
#include &quot;PcscReader.h&quot;

/* Calypso */
#include &quot;CalypsoPo.h&quot;
#include &quot;CalypsoSam.h&quot;
#include &quot;ElementaryFile.h&quot;
#include &quot;PoSecuritySettings.h&quot;
#include &quot;PoSelectionRequest.h&quot;
#include &quot;PoSelector.h&quot;
#include &quot;PoTransaction.h&quot;
#include &quot;SamRevision.h&quot;
#include &quot;SamSelector.h&quot;
#include &quot;SamSelectionRequest.h&quot;

using namespace keyple::calypso::command::po;
using namespace keyple::calypso::command::po::builder;
using namespace keyple::calypso::command::po::parser;
using namespace keyple::calypso::command::sam;
using namespace keyple::calypso::transaction;
using namespace keyple::common;
using namespace keyple::common::exception;
using namespace keyple::core::command::exception;
using namespace keyple::core::selection;
using namespace keyple::core::seproxy;
using namespace keyple::core::seproxy::event;
using namespace keyple::core::seproxy::exception;
using namespace keyple::core::seproxy::message;
using namespace keyple::core::seproxy::protocol;
using namespace keyple::core::util;
using namespace keyple::plugin::pcsc;

class DemoPoAuthentication final {};
const std::shared_ptr&lt;Logger&gt; logger = LoggerFactory::getLogger(typeid(DemoPoAuthentication));

// PO Reader name
const std::string PO_READER_NAME = &quot;XXX&quot;;

// SAM Reader name
const std::string SAM_READER_NAME = &quot;XXX&quot;;

// Keyple test kit profile 1, Application 2
const std::string AID = &quot;315449432E49434131&quot;;
const uint8_t RECORD_NUMBER_1 = 1;
const uint8_t SFI_Environment = 0x07;

int main(int argv, char **args)
{
    // Get the instance of the SeProxyService (Singleton pattern)
    SeProxyService&amp; seProxyService = SeProxyService::getInstance();

    logger-&gt;info(&quot;============================================================================\n&quot;);
    logger-&gt;info(&quot;=                  Get and Configure the PO &amp; SAM Readers                  =\n&quot;);
    logger-&gt;info(&quot;============================================================================\n&quot;);

    // Register the PcscPlugin with SeProxyService, get the corresponding generic ReaderPlugin
    auto pluginFactory = std::make_shared&lt;PcscPluginFactory&gt;();
    std::shared_ptr&lt;ReaderPlugin&gt; readerPlugin = seProxyService.registerPlugin(pluginFactory);

    // Get the PO reader
    std::shared_ptr&lt;SeReader&gt; poReader = readerPlugin-&gt;getReader(PO_READER_NAME);

    // Get a SAM reader
    std::shared_ptr&lt;SeReader&gt; samReader = readerPlugin-&gt;getReader(SAM_READER_NAME);

    // Eventually, configure the SAM reader parameters
    // ...

    /* Set Pcsc settings per reader */
    poReader-&gt;setParameter(PcscReader::SETTING_KEY_PROTOCOL, PcscReader::SETTING_PROTOCOL_T1);
    samReader-&gt;setParameter(PcscReader::SETTING_KEY_PROTOCOL, PcscReader::SETTING_PROTOCOL_T0);

    /*
     * PC/SC card access mode:
     *
     * The SAM is left in the SHARED mode (by default) to avoid automatic resets due to the limited
     * time between two consecutive exchanges granted by Windows.
     *
     * This point will be addressed in a coming release of the Keyple PcSc reader plugin.
     *
     * The PO reader is set to EXCLUSIVE mode to avoid side effects (on OS Windows 8+) during the
     * selection step that may result in session failures.
     *
     * See KEYPLE-CORE.PC.md file to learn more about this point.
     *
     */
    samReader-&gt;setParameter(PcscReader::SETTING_KEY_MODE, PcscReader::SETTING_MODE_SHARED);
    poReader-&gt;setParameter(PcscReader::SETTING_KEY_MODE, PcscReader::SETTING_MODE_SHARED);

    /* Set the PO reader protocol flag */
    poReader-&gt;addSeProtocolSetting(
        SeCommonProtocols::PROTOCOL_ISO14443_4,
        PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_ISO14443_4]);
    poReader-&gt;addSeProtocolSetting(
        SeCommonProtocols::PROTOCOL_B_PRIME,
        PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_B_PRIME]);
    samReader-&gt;addSeProtocolSetting(
        SeCommonProtocols::PROTOCOL_ISO7816_3,
        PcscProtocolSetting::PCSC_PROTOCOL_SETTING[SeCommonProtocols::PROTOCOL_ISO7816_3]);

    logger-&gt;info(&quot;============================================================================\n&quot;);
    logger-&gt;info(&quot;=              Create a SAM resource after selecting the SAM               =\n&quot;);
    logger-&gt;info(&quot;============================================================================\n&quot;);

    // Prepare the selector to ensure the correct SAM is used
    auto selector = SamSelector::builder()-&gt;samRevision(SamRevision::AUTO).build();
    auto samSelector = std::dynamic_pointer_cast&lt;SamSelector&gt;(selector);

    // Make the SAM selection
    SeSelection samSelection;
    auto samSelectionRequest = std::make_shared&lt;SamSelectionRequest&gt;(samSelector);
    auto abstractSamSelectionRequest =
        std::reinterpret_pointer_cast&lt;AbstractSeSelectionRequest&lt;AbstractApduCommandBuilder&gt;&gt;(
            samSelectionRequest);
    samSelection.prepareSelection(abstractSamSelectionRequest);
    std::shared_ptr&lt;CalypsoSam&gt; calypsoSam;
    if (samReader-&gt;isSePresent()) {
        std::shared_ptr&lt;SelectionsResult&gt; selectionsResult =
            samSelection.processExplicitSelection(samReader);
        if (selectionsResult-&gt;hasActiveSelection()) {
            calypsoSam = std::dynamic_pointer_cast&lt;CalypsoSam&gt;(
                selectionsResult-&gt;getActiveMatchingSe());
        } else {
            throw IllegalStateException(&quot;SAM matching failed!&quot;);
        }
    } else {
        throw IllegalStateException(&quot;No SAM is present in the reader &quot; + samReader-&gt;getName());
    }

    // Associate the calypsoSam and the samReader to create the samResource
    auto samResource = std::make_shared&lt;SeResource&lt;CalypsoSam&gt;&gt;(samReader, calypsoSam);

    // Prepare the security settings used during the Calypso transaction
    auto poSecuritySettings =
        std::make_shared&lt;PoSecuritySettings::PoSecuritySettingsBuilder&gt;(samResource)-&gt;build();

    logger-&gt;info(&quot;============================================================================\n&quot;);
    logger-&gt;info(&quot;=           Display basic information about the readers and SAM            =\n&quot;);
    logger-&gt;info(&quot;============================================================================\n&quot;);

    logger-&gt;info(&quot;= PO Reader Name = %\n&quot;, poReader-&gt;getName());
    const std::string samSerialNumber =
        ByteArrayUtil::toHex(samResource-&gt;getMatchingSe()-&gt;getSerialNumber());
    logger-&gt;info(&quot;= SAM Reader Name = %, Serial Number = %\n&quot;,
                 samResource-&gt;getSeReader()-&gt;getName(),
                 samSerialNumber);

    logger-&gt;info(&quot;============================================================================\n&quot;);
    logger-&gt;info(&quot;=                     Prepare the Calypso PO selection                     =\n&quot;);
    logger-&gt;info(&quot;============================================================================\n&quot;);

    // Prepare a Calypso PO selection
    SeSelection seSelection;

    // Setting of an AID based selection of a Calypso Revision 3.1 PO
    //
    // Select the first application matching the selection AID whatever the card communication
    // protocol
    // Keep the logical channel open after the selection
    //
    // Calypso selection: configures a PoSelectionRequest with all the desired attributes to
    // make the selection and read additional information afterwards
    auto aidSelector = SeSelector::AidSelector::builder()-&gt;aidToSelect(AID).build();
    auto seSelector = PoSelector::builder()-&gt;aidSelector(aidSelector) // the application identifier
                                            // to indicate if an invalidated PO should be accepted
                                            // or not
                                            .invalidatedPo(PoSelector::InvalidatedPo::REJECT)
                                            .build();
    auto poSelector = std::dynamic_pointer_cast&lt;PoSelector&gt;(seSelector);
    auto poSelectionRequest = std::make_shared&lt;PoSelectionRequest&gt;(poSelector);


    // Add the selection case to the current selection
    // (we could have added other cases)
    auto abstractPoSelectionRequest =
        std::reinterpret_pointer_cast&lt;AbstractSeSelectionRequest&lt;AbstractApduCommandBuilder&gt;&gt;(
            poSelectionRequest);
    seSelection.prepareSelection(abstractPoSelectionRequest);

    logger-&gt;info(&quot;============================================================================\n&quot;);
    logger-&gt;info(&quot;=                  Check if a PO is present in the reader                  =\n&quot;);
    logger-&gt;info(&quot;============================================================================\n&quot;);

    if (poReader-&gt;isSePresent()) {
        logger-&gt;info(&quot;============================================================================\n&quot;);
        logger-&gt;info(&quot;=                    Start of the Calypso PO processing                    =\n&quot;);
        logger-&gt;info(&quot;============================================================================\n&quot;);
        logger-&gt;info(&quot;=                             1st PO exchange                              =\n&quot;);
        logger-&gt;info(&quot;=                           AID based selection                            =\n&quot;);
        logger-&gt;info(&quot;============================================================================\n&quot;);

        try {
            // Actual PO communication: operate through a single request the Calypso PO selection
            std::shared_ptr&lt;CalypsoPo&gt; calypsoPo =
                std::dynamic_pointer_cast&lt;CalypsoPo&gt;(
                    seSelection.processExplicitSelection(poReader)-&gt;getActiveMatchingSe());

            logger-&gt;info(&quot;The selection of the PO has succeeded\n&quot;);

            logger-&gt;info(&quot;============================================================================\n&quot;);
            logger-&gt;info(&quot;=                            2nd PO exchange                               =\n&quot;);
            logger-&gt;info(&quot;=                     Open a Calypso secure session                        =\n&quot;);
            logger-&gt;info(&quot;=                  Reading of Environment file (SFI=07h)                   =\n&quot;);
            logger-&gt;info(&quot;============================================================================\n&quot;);

            // Create a PoTransaction object to manage the Calypso transaction
            auto poTransaction = std::make_shared&lt;PoTransaction&gt;(
                                     std::make_shared&lt;SeResource&lt;CalypsoPo&gt;&gt;(poReader, calypsoPo),
                                     poSecuritySettings);

            // Read the Environment file at the Session Opening
            // (we could have added other commands)
            poTransaction-&gt;prepareReadRecordFile(
                    SFI_Environment, // the sfi to select
                    RECORD_NUMBER_1);

            // Open Session with the debit key
            poTransaction-&gt;processOpening(
                PoTransaction::SessionSetting::AccessLevel::SESSION_LVL_DEBIT);

            // Get the Environment data
            std::shared_ptr&lt;ElementaryFile&gt; efEnvironment =
                calypsoPo-&gt;getFileBySfi(SFI_Environment);

            const std::string environmentLog =
                ByteArrayUtil::toHex(efEnvironment-&gt;getData()-&gt;getContent());
            logger-&gt;info(&quot;File Environment log: %\n&quot;, environmentLog);

            if (!calypsoPo-&gt;isDfRatified()) {
                logger-&gt;info(&quot;============= Previous Calypso Secure Session was not ratified =============\n&quot;);
            }

            logger-&gt;info(&quot;============================================================================\n&quot;);
            logger-&gt;info(&quot;=                            3th PO exchange                               =\n&quot;);
            logger-&gt;info(&quot;=                     Close the Calypso secure session                     =\n&quot;);
            logger-&gt;info(&quot;============================================================================\n&quot;);

            // To close the channel with the PO after the closing
            poTransaction-&gt;prepareReleasePoChannel();

            // Close the Calypso Secure Session
            // A ratification command will be sent (CONTACTLESS_MODE)
            poTransaction-&gt;processClosing();

            logger-&gt;info(&quot;============================================================================\n&quot;);
            logger-&gt;info(&quot;=              The Calypso secure session ended successfully               =\n&quot;);
            logger-&gt;info(&quot;=                   (Successful mutual authentication)                     =\n&quot;);
            logger-&gt;info(&quot;=                    End of the Calypso PO processing                      =\n&quot;);
            logger-&gt;info(&quot;============================================================================\n&quot;);
        } catch (const Exception&amp; e) {
            logger-&gt;error(&quot;Exception: %\n&quot;, e.getMessage());
        }
    } else {
        logger-&gt;error(&quot;The selection of the PO has failed\n&quot;);
    }

    return 0;
}
</code></pre>
<h4 id=sample-trace>Sample trace</h4>
<pre><code class=language-bash>============================================================================
=                  Get and Configure the PO &amp; SAM Readers                  =
============================================================================
initNativeReaders - getting card terminals
run - starting executor monitoring thread
[PcscReaderImpl] constructor =&gt; using terminal OMNIKEY CardMan (076B:5421) 5421(1)
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME =transmission_mode, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME = protocol, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME = mode, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME = disconnect, VALUE =
run - starting executor monitoring thread
constructor =&gt; using terminal OMNIKEY CardMan (076B:5421) 5421(2)
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = transmission_mode, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = protocol, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = mode, VALUE =
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = disconnect, VALUE =
Registering a new Plugin to the platform : PcscPlugin
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = protocol, VALUE = T1
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME = protocol, VALUE = T0
[OMNIKEY CardMan (076B:5421) 5421(1)] setParameter =&gt; PCSC: Set a parameter. NAME = mode, VALUE = shared
[OMNIKEY CardMan (076B:5421) 5421(2)] setParameter =&gt; PCSC: Set a parameter. NAME = mode, VALUE = shared
============================================================================
=              Create a SAM resource after selecting the SAM               =
============================================================================
protocolFlagMatches - physical channel not open, opening it
[OMNIKEY CardMan (076B:5421) 5421(1)] openAndConnect - protocol: T=0
openAndConnect - connecting tp OMNIKEY CardMan (076B:5421) 5421(1) with protocol: T=0, connectProtocol: 1
    and sharingMode: 2
openAndConnect - card state: 84
[OMNIKEY CardMan (076B:5421) 5421(1)] Opening of a physical SE channel in shared mode
[OMNIKEY CardMan (076B:5421) 5421(1)] protocolFlagMatches =&gt; matching SE. PROTOCOLFLAG = SEPROTOCOL:
    {NAME = ISO 7816-3, TRANMISSIONMODE = CONTACTS}
processSeRequestSet - processing requests set
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequests =&gt; transmit SEREQUEST: {REQUESTS = ApduRequests: {},
    SELECTOR = SESELECTOR: {SEPROTOCOL: {NAME = ISO 7816-3, TRANMISSIONMODE = CONTACTS}AIDSELECTOR = null,
    ATRFILTER: {REGEX = .*}}}
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequest =&gt; Logical channel open = 0
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequests =&gt; receive SERESPONSE: {RESPONSES = APDURESPONSES: {},
     SELECTIONSTATUS = SELECTIONSTATUS: {ATR = ATR = 3b3f9600805a4880c1205017aec11a36829000, FCI = R-APDU:
     {STATUS = FAILURE, BYTES (0) = }, HASMATCHED = 1}, CHANNELWASOPEN = 0}
============================================================================
=           Display basic information about the readers and SAM            =
============================================================================
= PO Reader Name = OMNIKEY CardMan (076B:5421) 5421(2)
= SAM Reader Name = OMNIKEY CardMan (076B:5421) 5421(1), Serial Number = AEC11A36
============================================================================
=                     Prepare the Calypso PO selection                     =
============================================================================
============================================================================
=                  Check if a PO is present in the reader                  =
============================================================================
============================================================================
=                    Start of the Calypso PO processing                    =
============================================================================
=                             1st PO exchange                              =
=                           AID based selection                            =
============================================================================
protocolFlagMatches - physical channel not open, opening it
[OMNIKEY CardMan (076B:5421) 5421(2)] openAndConnect - protocol: T=1
openAndConnect - connecting tp OMNIKEY CardMan (076B:5421) 5421(2) with protocol: T=1, connectProtocol: 2
    and sharingMode: 2
openAndConnect - card state: 84
[OMNIKEY CardMan (076B:5421) 5421(2)] Opening of a physical SE channel in shared mode
[OMNIKEY CardMan (076B:5421) 5421(2)] protocolFlagMatches =&gt; matching SE. PROTOCOLFLAG = SEPROTOCOL:
    {NAME = ISO 14443-4, TRANMISSIONMODE = CONTACTLESS}
processSeRequestSet - processing requests set
[OMNIKEY CardMan (076B:5421) 5421(2)] processSeRequests =&gt; transmit SEREQUEST: {REQUESTS = ApduRequests:
    {}, SELECTOR = SESELECTOR: {SEPROTOCOL: {NAME = ISO 14443-4, TRANMISSIONMODE = CONTACTLESS}AIDSELECTOR:
    {AIDTOSELECT = 315449432e49434131FILEOCCURRENCE: {ISOBITMASK = 0(0x00)}FILECONTROLINFORMATION:
    {ISOBITMASK = 0(0x00)}0x0}, ATRFILTER = null}}
[OMNIKEY CardMan (076B:5421) 5421(2)] processSeRequest =&gt; Logical channel open = 0
[OMNIKEY CardMan (076B:5421) 5421(2)] openLogicalChannel =&gt; Select Application with AID = 315449432e49434131
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; APDUREQUEST: {NAME = Internal Select Application,
    RAWDATA = 00a4040009315449432e4943413100, CASE4 = 1}, elapsed 13c ms
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - c-apdu &gt;&gt; 00a4040009315449432e4943413100
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - r-apdu &lt;&lt;
    6f238409315449432e49434131a516bf0c13c70800000000c17be1f653070a3c23051410019000
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (39) = 6f238409315449432e49434131a516bf0c13c70800000000c17be1f653070a3c23051410019000}, elapsed c ms
[OMNIKEY CardMan (076B:5421) 5421(2)] processSeRequests =&gt; receive SERESPONSE: {RESPONSES = APDURESPONSES: {},
    SELECTIONSTATUS = SELECTIONSTATUS: {ATR = ATR = 3b888001000000009171710098, FCI = R-APDU: {STATUS = SUCCESS,
    BYTES (27) = 6f238409315449432e49434131a516bf0c13c70800000000c17be1f653070a3c23051410019000}, HASMATCHED = 1},
    CHANNELWASOPEN = 0}
Application Serial Number = 00000000C17BE1F6
Discretionary Data = 0a3c2305141001
The selection of the PO has succeeded
============================================================================
=                            2nd PO exchange                               =
=                     Open a Calypso secure session                        =
=                  Reading of Environment file (SFI=07h)                   =
============================================================================
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequest =&gt; Logical channel open = 1
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; APDUREQUEST: {NAME = Select Diversifier,
    RAWDATA = 801400000800000000c17be1f6, CASE4 = 0}, elapsed 208 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - c-apdu &gt;&gt; 801400000800000000c17be1f6
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - r-apdu &lt;&lt; 9000
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (2) =
    9000}, elapsed 37 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; APDUREQUEST: {NAME = Get Challenge,
    RAWDATA =  8084000004, CASE4 = 0}, elapsed 0 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - c-apdu &gt;&gt; 8084000004
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - r-apdu &lt;&lt; ef48651d9000
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (6) =
    ef48651d9000}, elapsed 3 ms
identification: TERMINALCHALLENGE = ef48651d
[OMNIKEY CardMan (076B:5421) 5421(2)] processSeRequest =&gt; Logical channel open = 1
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; APDUREQUEST: {NAME = Open Secure Session
    V3.1 -  KEYINDEX=3, SFI=07, REC=1, RAWDATA = 008a0b3904ef48651d00, CASE4 = 1}, elapsed c7 ms
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - c-apdu &gt;&gt; 008a0b3904ef48651d00
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - r-apdu &lt;&lt;
    030ab2cf0030791d00000000000000000000000000000000000000000000000000000000009000
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (39) = 030ab2cf0030791d00000000000000000000000000000000000000000000000000000000009000}, elapsed e ms
processAtomicOpening =&gt; opening: CARDCHALLENGE = CF, POKIF = 30, POKVC = 79
initialize: POREVISION = REV3_1, SAMREVISION = C1, SESSIONENCRYPTION = 0, VERIFICATIONMODE = 0
initialize: VERIFICATIONMODE = 0, REV32MODE = 0, KEYRECNUMBER = 0(0x00)
initialize: KIF = 48(0x30), KVC = 79(0x79), DIGESTDATA =
    030ab2cf0030791d0000000000000000000000000000000000000000000000000000000000
File Environment log: 0000000000000000000000000000000000000000000000000000000000
============================================================================
=                            3th PO exchange                               =
=                     Close the Calypso secure session                     =
============================================================================
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequest =&gt; Logical channel open = 1
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; APDUREQUEST: {NAME = Digest Init, RAWDATA = 808a00ff273079030ab2cf0030791d0000000000000000000000000000000000000000000000000000000000, CASE4 = 0},
    elapsed 2f ms
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - c-apdu &gt;&gt;
    808a00ff273079030ab2cf0030791d0000000000000000000000000000000000000000000000000000000000
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - r-apdu &lt;&lt; 9000
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (2) = 9000},
    elapsed 6 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; APDUREQUEST: {NAME = Digest Close,
    RAWDATA = 808e000004, CASE4 = 0}, elapsed 0 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - c-apdu &gt;&gt; 808e000004
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - r-apdu &lt;&lt; 819e515d9000
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (6) =
    819e515d9000}, elapsed 9 ms
SIGNATURE = 819e515d
[OMNIKEY CardMan (076B:5421) 5421(2)] processSeRequest =&gt; Logical channel open = 1
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; APDUREQUEST: {NAME = Close Secure Session,
    RAWDATA = 008e800004819e515d00, CASE4 = 1}, elapsed 31 ms
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - c-apdu &gt;&gt; 008e800004819e515d00
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - r-apdu &lt;&lt; 08d222e99000
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (6) =
    08d222e99000}, elapsed 34 ms
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; APDUREQUEST: {NAME = , RAWDATA = 00b2000000,
    CASE4 = 0}, elapsed 0 ms
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - c-apdu &gt;&gt; 00b2000000
[OMNIKEY CardMan (076B:5421) 5421(2)] transmitApdu - r-apdu &lt;&lt; 6b00
[OMNIKEY CardMan (076B:5421) 5421(2)] processApduRequest =&gt; R-APDU: {STATUS = FAILURE, BYTES (2) = 6b00},
    elapsed 2a ms
[OMNIKEY CardMan (076B:5421) 5421(2)] closePhysicalChannel
[OMNIKEY CardMan (076B:5421) 5421(2)] closeAndDisconnect - reset: y
[OMNIKEY CardMan (076B:5421) 5421(2)] Ignore =&gt;  Event SE_PROCESSED received in currentState
    WAIT_FOR_START_DETECTION
[OMNIKEY CardMan (076B:5421) 5421(1)] processSeRequest =&gt; Logical channel open = 1
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; APDUREQUEST: {NAME = Digest Authenticate,
    RAWDATA = 808200000408d222e9, CASE4 = 0}, elapsed 61 ms
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - c-apdu &gt;&gt; 808200000408d222e9
[OMNIKEY CardMan (076B:5421) 5421(1)] transmitApdu - r-apdu &lt;&lt; 9000
[OMNIKEY CardMan (076B:5421) 5421(1)] processApduRequest =&gt; R-APDU: {STATUS = SUCCESS, BYTES (2) = 9000},
    elapsed 5e ms
============================================================================
=              The Calypso secure session ended successfully               =
=                   (Successful mutual authentication)                     =
=                    End of the Calypso PO processing                      =
============================================================================
</code></pre>
</div>
<div class=article-widget>
<div class=post-nav>
<div class=post-nav-item>
<div class=meta-nav>Previous</div>
<a href=../../../docs-1.0/build-your-first-app/android-app/ rel=next>Build your first Android application</a>
</div>
</div>
</div>
</div>
<div class=body-footer>
<p>Last updated on 2021-10-26</p>
</div>
</article>
<footer class=site-footer>
<div class=container>
<div class="row featurette">
<div class="col-12 col-sm-4">
<p style=color:#fff><b>ECLIPSE LEGAL</b></p>
<a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a><br>
<a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a><br>
<a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a><br>
<a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a><br>
<a href=https://www.eclipse.org/legal/>Legal Resources</a><br>
<a href=https://eclipse.org/security/ target=_blank>Report a Vulnerability</a><br>
</div>
<div class="col-12 col-sm-4">
<a href=https://www.eclipse.org target=_blank>
<img src=../../../media/eclipse_foundation_logo.svg id=logo-eclipse-foundation>
</a>
</div>
<div class="col-12 col-sm-4">
<a href=https://iot.eclipse.org target=_blank>
<img src=../../../media/eclipse_iot_logo.svg id=logo-eclipse-iot>
</a>
</div>
</div>
</div>
<p class=powered-by id=copyright>
© 2020-2021 The Eclipse Keyple® project. All Rights Reserved.
</p>
<p class=powered-by id=template-info>
Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.
</p>
</footer>
</main>
</div>
</div>
</div>
<div class=page-footer>
</div>
<div id=modal class="modal fade" role=dialog>
<div class=modal-dialog>
<div class=modal-content>
<div class=modal-header>
<h5 class=modal-title>Cite</h5>
<button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span>
</button>
</div>
<div class=modal-body>
<pre><code class="tex hljs"></code></pre>
</div>
<div class=modal-footer>
<a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank>
<i class="fas fa-copy"></i> Copy
</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank>
<i class="fas fa-download"></i> Download
</a>
<div id=modal-error></div>
</div>
</div>
</div>
</div>
<script src=../../../js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/java.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/groovy.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/xml.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/kotlin.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/cpp.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/gradle.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/ini.min.js crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin=anonymous></script>
<script>anchors.add()</script>
<script id=search-hit-fuse-template type=text/x-template>
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script>
<script src=../../../en/js/wowchemy.min.96e2cf865602a486f1ca65bc1c9a3bef.js></script>
<link rel=stylesheet href=https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css>
<script src=https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js></script>
<script src=https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js></script>
</body>
</html>