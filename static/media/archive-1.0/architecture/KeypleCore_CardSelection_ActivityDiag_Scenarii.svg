<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1023px" preserveAspectRatio="none" style="width:472px;height:1023px;" version="1.1" viewBox="0 0 472 1023" width="472px" zoomAndPan="magnify"><defs/><g><ellipse cx="207" cy="20" fill="#000000" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FFFFFF" height="194.8906" style="stroke: #000000; stroke-width: 2.0;" width="208" x="103" y="40"/><path d="M236,41 L236,50.6094 L226,60.6094 L103,60.6094 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="106" y="55.5332">Reader initialization</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="99" x="157.5" y="77.6094"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="79" x="167.5" y="100.0664">register plugin</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="76" x="169" y="132.7031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="56" x="179" y="155.1602">get reader</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="188" x="113" y="187.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="168" x="123" y="210.2539">prepare card selection request</text><polygon fill="#FEFECE" points="162.5,254.8906,251.5,254.8906,263.5,266.8906,251.5,278.8906,162.5,278.8906,150.5,266.8906,162.5,254.8906" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="89" x="162.5" y="271.3916">transaction mode?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="79" x="71.5" y="264.4736">explicit selection</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="79" x="263.5" y="264.4736">default selection</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="122" x="28" y="288.8906"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="102" x="38" y="311.3477">test card presence</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="158" x="10" y="358.9844"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="138" x="20" y="381.4414">process explicit selection</text><rect fill="#FFFFFF" height="209.8906" style="stroke: #000000; stroke-width: 2.0;" width="249" x="200.5" y="288.8906"/><path d="M439.5,289.8906 L439.5,299.5 L429.5,309.5 L200.5,309.5 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="229" x="203.5" y="304.4238">Observer: observable reader setting</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="189" x="230.5" y="326.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="169" x="240.5" y="348.957">default selection reader setting</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="189" x="230.5" y="396.5938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="169" x="240.5" y="419.0508">reader notification subscribtion</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="130" x="260" y="451.6875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="110" x="270" y="474.1445">"wait card detection"</text><rect fill="#000000" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="224" x="213" y="508.7813"/><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="143" x="253.5" y="534.7813"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="123" x="263.5" y="557.2383">polling card presence)</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="95" x="277.5" y="579.875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="75" x="287.5" y="602.332">card insertion</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="158" x="246" y="634.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="138" x="256" y="657.4258">process default selection</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="196" x="227" y="690.0625"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="176" x="237" y="712.5195">notifies card inserted &amp; selected</text><rect fill="#000000" height="6" rx="2.5" ry="2.5" style="stroke: #000000; stroke-width: 1.0;" width="224" x="213" y="735.1563"/><rect fill="#FFFFFF" height="84.7031" style="stroke: #000000; stroke-width: 2.0;" width="273.5" x="188" y="751.7324"/><path d="M452,752.7324 L452,762.3418 L442,772.3418 L188,772.3418 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="254" x="191" y="767.2656">Observer: reader notification processing</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="174" x="238" y="789.3418"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="248" y="811.7988">process selection response</text><polygon fill="#FEFECE" points="207,842.4355,219,854.4355,207,866.4355,195,854.4355,207,842.4355" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="114" x="150" y="886.4355"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="94" x="160" y="908.8926">get selected card</text><rect fill="#FEFECE" height="35.0938" rx="12.5" ry="12.5" style="stroke: #D4AC0D; stroke-width: 1.5;" width="210" x="102" y="977.6182"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="190" x="112" y="1000.0752">send APDU commands to the card</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="207" x2="207" y1="112.7031" y2="132.7031"/><polygon fill="#A80036" points="203,122.7031,207,132.7031,211,122.7031,207,126.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207" x2="207" y1="167.7969" y2="187.7969"/><polygon fill="#A80036" points="203,177.7969,207,187.7969,211,177.7969,207,181.7969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207" x2="207" y1="30" y2="77.6094"/><polygon fill="#A80036" points="203,67.6094,207,77.6094,211,67.6094,207,71.6094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="89" x2="89" y1="323.9844" y2="358.9844"/><polygon fill="#A80036" points="85,348.9844,89,358.9844,93,348.9844,89,352.9844" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="361.5938" y2="396.5938"/><polygon fill="#A80036" points="321,386.5938,325,396.5938,329,386.5938,325,390.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="431.6875" y2="451.6875"/><polygon fill="#A80036" points="321,441.6875,325,451.6875,329,441.6875,325,445.6875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="614.9688" y2="634.9688"/><polygon fill="#A80036" points="321,624.9688,325,634.9688,329,624.9688,325,628.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="670.0625" y2="690.0625"/><polygon fill="#A80036" points="321,680.0625,325,690.0625,329,680.0625,325,684.0625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="514.7813" y2="534.7813"/><polygon fill="#A80036" points="321,524.7813,325,534.7813,329,524.7813,325,528.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="741.1563" y2="789.3418"/><polygon fill="#A80036" points="321,779.3418,325,789.3418,329,779.3418,325,783.3418" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="150.5" x2="89" y1="266.8906" y2="266.8906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="89" x2="89" y1="266.8906" y2="288.8906"/><polygon fill="#A80036" points="85,278.8906,89,288.8906,93,278.8906,89,282.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="263.5" x2="325" y1="266.8906" y2="266.8906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="266.8906" y2="326.5"/><polygon fill="#A80036" points="321,316.5,325,326.5,329,316.5,325,320.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="89" x2="89" y1="394.0781" y2="854.4355"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="89" x2="195" y1="854.4355" y2="854.4355"/><polygon fill="#A80036" points="185,850.4355,195,854.4355,185,858.4355,189,854.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="325" y1="824.4355" y2="854.4355"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="325" x2="219" y1="854.4355" y2="854.4355"/><polygon fill="#A80036" points="229,850.4355,219,854.4355,229,858.4355,225,854.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207" x2="207" y1="222.8906" y2="254.8906"/><polygon fill="#A80036" points="203,244.8906,207,254.8906,211,244.8906,207,248.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="207" x2="207" y1="866.4355" y2="886.4355"/><polygon fill="#A80036" points="203,876.4355,207,886.4355,211,876.4355,207,880.4355" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.5; stroke-dasharray: 7.0,7.0;" x1="207" x2="207" y1="921.5293" y2="977.6182"/><polygon fill="#008000" points="203,967.6182,207,977.6182,211,967.6182,207,971.6182" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="148" x="211" y="943.8652">Then specific operations could</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="143" x="217" y="957.7012">be processed with the card...</text><!--MD5=[a5ce231584a1e306bd1a7aa9a5213e6e]
@startuml
skinparam ClassBorderColor #D4AC0D
skinparam stereotypeABorderColor #A9DCDF
skinparam stereotypeIBorderColor #B4A7E5
skinparam stereotypeCBorderColor #ADD1B2
skinparam stereotypeEBorderColor #EB93DF
skinparam shadowing false

skinparam StateBorderColor #D4AC0D
skinparam ActivityBorderColor #D4AC0D

skinparam ClassBackgroundColor<<red>> #FDEDEC
skinparam ClassBorderColor<<red>> #E74C3C
hide <<red>> stereotype
skinparam ClassBackgroundColor<<purple>> #F4ECF7
skinparam ClassBorderColor<<purple>> #8E44AD
hide <<purple>> stereotype
skinparam ClassBackgroundColor<<blue>> #EBF5FB
skinparam ClassBorderColor<<blue>> #3498DB
hide <<blue>> stereotype
skinparam ClassBackgroundColor<<green>> #EAFAF1
skinparam ClassBorderColor<<green>> #2ECC71
hide <<green>> stereotype

skinparam ClassBackgroundColor<<orange>> #FDF2E9
skinparam ClassBorderColor<<orange>> #E67E22
hide <<orange>> stereotype

skinparam ClassBackgroundColor<<grey>> #EAECEE
skinparam ClassBorderColor<<grey>> #2C3E50
hide <<grey>> stereotype

start
partition "Reader initialization" {
	:register plugin;
	:get reader;
	:prepare card selection request;
}

if (transaction mode?) then (explicit selection)
	:test card presence;
	:process explicit selection;
else (default selection)
	partition "Observer: observable reader setting" {
	:default selection reader setting;
	:reader notification subscribtion;
	:"wait card detection";
	}
	detach
	fork
		:polling card presence);
		detach
		:card insertion;
		:process default selection;
		:notifies card inserted & selected;
	end fork
	detach
	partition "Observer: reader notification processing" {
		:process selection response;
	}
endif
	:get selected card;
-[#green,dashed]-> Then specific operations could
  be processed with the card...;
	:send APDU commands to the card;
@enduml

PlantUML version 1.2020.09(Sun May 10 14:51:06 MUT 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-b765.64
Operating System: Windows 10
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>