<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="4350px" preserveAspectRatio="none" style="width:3370px;height:4350px;" version="1.1" viewBox="0 0 3370 4350" width="3370px" zoomAndPan="magnify"><defs><filter height="1" id="b1gq5yoxg2u9iy0" width="1" x="0" y="0"><feFlood flood-color="#ADD8E6" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter></defs><g><rect fill="#FEF9E7" height="4286.6094" rx="10" ry="10" style="stroke: #A80036; stroke-width: 2.0;" width="1650" x="252" y="8"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="338" x="908" y="34.9902">Client APP using Local Lib</text><rect fill="#FDF2E9" height="4286.6094" rx="10" ry="10" style="stroke: #A80036; stroke-width: 2.0;" width="1368" x="1906" y="8"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="376" x="2402" y="34.9902">Server APP using Remote Lib</text><rect fill="#FFFFE0" height="2666.0469" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="81" y="1408.125"/><rect fill="#ADD8E6" height="242.8125" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="397" y="1408.125"/><rect fill="#ADD8E6" height="93.2188" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="674" y="870.6875"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="674" y="1200.0156"/><rect fill="#FFC0CB" height="3500.8125" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="1160" y="573.3594"/><rect fill="#ADD8E6" height="1918.9063" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="1738" y="2137.2656"/><rect fill="#ADD8E6" height="145.9219" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="2165.2656"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="2371.8906"/><rect fill="#ADD8E6" height="88.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="3906.7656"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="2493.2969"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="2942.2188"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3096.3281"/><rect fill="#ADD8E6" height="28" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3217.7344"/><rect fill="#ADD8E6" height="182.1094" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3563.25"/><rect fill="#FFC0CB" height="3809.0313" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="3009" y="265.1406"/><rect fill="#FDF2E9" height="398.9219" rx="10" ry="10" style="stroke: #000000; stroke-width: 4.0;" width="3277" x="26" y="3362.4375"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="90" x2="90" y1="245.1406" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="406" x2="406" y1="929.2969" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="684" x2="684" y1="839.9844" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="1170" x2="1170" y1="245.1406" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="1748" x2="1748" y1="750.6719" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="2074" x2="2074" y1="436.8984" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="2502" x2="2502" y1="2243.875" y2="4092.1719"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 5.0,5.0;" x1="3018" x2="3018" y1="245.1406" y2="4092.1719"/><rect fill="#FEFECE" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="90" x="46" y="179.9219"/><text fill="#000000" font-family="sans-serif" font-size="28" lengthAdjust="spacingAndGlyphs" textLength="62" x="60" y="222.9883">Card</text><rect fill="#FEFECE" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="90" x="46" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" lengthAdjust="spacingAndGlyphs" textLength="62" x="60" y="4133.2383">Card</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="294" x="260" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="274" y="4133.2383">ObservableReader</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="116" x="626" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="640" y="4133.2383">Plugin</text><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="1042" y="238.9883">Ticketing Service</text><ellipse cx="1170" cy="103.9219" fill="#FEFECE" rx="16" ry="16" style="stroke: #A80036; stroke-width: 4.0;"/><path d="M1170,119.9219 L1170,173.9219 M1144,135.9219 L1196,135.9219 M1170,173.9219 L1144,203.9219 M1170,173.9219 L1196,203.9219 " fill="none" style="stroke: #A80036; stroke-width: 4.0;"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="1042" y="4119.2383">Ticketing Service</text><ellipse cx="1170" cy="4145.3906" fill="#FEFECE" rx="16" ry="16" style="stroke: #A80036; stroke-width: 4.0;"/><path d="M1170,4161.3906 L1170,4215.3906 M1144,4177.3906 L1196,4177.3906 M1170,4215.3906 L1144,4245.3906 M1170,4215.3906 L1196,4245.3906 " fill="none" style="stroke: #A80036; stroke-width: 4.0;"/><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="292" x="1602" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="264" x="1616" y="4133.2383">LocalServiceClient</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="320" x="1914" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="1928" y="4133.2383">RemotePluginServer</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="498" x="2254" y="4090.1719"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="470" x="2268" y="4133.2383">ObservableRemoteReaderServer</text><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="360" x="2829" y="203.7695">Remote Ticketing Service</text><text fill="#000000" font-family="sans-serif" font-size="28" lengthAdjust="spacingAndGlyphs" textLength="8" x="3189" y="203.7695">:</text><text fill="#000000" filter="url(#b1gq5yoxg2u9iy0)" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="482" x="2772" y="238.9883">ObservablePlugin.PluginObserver</text><ellipse cx="3019" cy="68.7031" fill="#FEFECE" rx="16" ry="16" style="stroke: #A80036; stroke-width: 4.0;"/><path d="M3019,84.7031 L3019,138.7031 M2993,100.7031 L3045,100.7031 M3019,138.7031 L2993,168.7031 M3019,138.7031 L3045,168.7031 " fill="none" style="stroke: #A80036; stroke-width: 4.0;"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="360" x="2829" y="4119.2383">Remote Ticketing Service</text><text fill="#000000" font-family="sans-serif" font-size="28" lengthAdjust="spacingAndGlyphs" textLength="8" x="3189" y="4119.2383">:</text><text fill="#000000" filter="url(#b1gq5yoxg2u9iy0)" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="482" x="2772" y="4154.457">ObservablePlugin.PluginObserver</text><ellipse cx="3019" cy="4180.6094" fill="#FEFECE" rx="16" ry="16" style="stroke: #A80036; stroke-width: 4.0;"/><path d="M3019,4196.6094 L3019,4250.6094 M2993,4212.6094 L3045,4212.6094 M3019,4250.6094 L2993,4280.6094 M3019,4250.6094 L3045,4280.6094 " fill="none" style="stroke: #A80036; stroke-width: 4.0;"/><rect fill="#FFFFE0" height="2666.0469" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="81" y="1408.125"/><rect fill="#ADD8E6" height="242.8125" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="397" y="1408.125"/><rect fill="#ADD8E6" height="93.2188" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="674" y="870.6875"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="674" y="1200.0156"/><rect fill="#FFC0CB" height="3500.8125" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="1160" y="573.3594"/><rect fill="#ADD8E6" height="1918.9063" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="1738" y="2137.2656"/><rect fill="#ADD8E6" height="145.9219" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="2165.2656"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="2371.8906"/><rect fill="#ADD8E6" height="88.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2064" y="3906.7656"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="2493.2969"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="2942.2188"/><rect fill="#ADD8E6" height="60.7031" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3096.3281"/><rect fill="#ADD8E6" height="28" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3217.7344"/><rect fill="#ADD8E6" height="182.1094" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="2493" y="3563.25"/><rect fill="#FFC0CB" height="3809.0313" style="stroke: #A80036; stroke-width: 2.0;" width="20" x="3009" y="265.1406"/><rect fill="#EEEEEE" height="6" style="stroke: #EEEEEE; stroke-width: 2.0;" width="3341" x="6" y="307.4922"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="307.4922" y2="307.4922"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="313.4922" y2="313.4922"/><rect fill="#EEEEEE" height="48.7031" style="stroke: #000000; stroke-width: 4.0;" width="348" x="1502.5" y="285.1406"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="312" x="1514.5" y="320.1309">Remote Lib Initialization</text><polygon fill="#A80036" points="2256,455.9531,2236,463.9531,2256,471.9531,2248,463.9531" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2244" x2="3007" y1="463.9531" y2="463.9531"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="370" x="2268" y="388.834">smartCardService.registerPlugin</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="354" x="2276" y="421.5371">(RemotePluginServerFactory...</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="326" x="2300" y="454.2402">.withPluginObserver (this)...)</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="320" x="1914" y="394.7344"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="292" x="1928" y="437.8008">RemotePluginServer</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3123" y1="547.3594" y2="547.3594"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3123" x2="3123" y1="547.3594" y2="573.3594"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3041" x2="3123" y1="573.3594" y2="573.3594"/><polygon fill="#A80036" points="3061,565.3594,3041,573.3594,3061,581.3594,3053,573.3594" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="212" x="3053" y="504.9434">Awaiting receipt of</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="190" x="3061" y="537.6465">a Plugin Event...</text><rect fill="#EEEEEE" height="6" style="stroke: #EEEEEE; stroke-width: 2.0;" width="3341" x="6" y="641.7109"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="641.7109" y2="641.7109"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="647.7109" y2="647.7109"/><rect fill="#EEEEEE" height="48.7031" style="stroke: #000000; stroke-width: 4.0;" width="320" x="1516.5" y="619.3594"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="1528.5" y="654.3496">Local Lib Initialization</text><polygon fill="#A80036" points="1578,724.7656,1598,732.7656,1578,740.7656,1586,732.7656" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1590" y1="732.7656" y2="732.7656"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="324" x="1194" y="723.0527">LocalServiceClientFactory...</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="292" x="1602" y="688.0625"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="264" x="1616" y="731.1289">LocalServiceClient</text><polygon fill="#A80036" points="764,842.6875,744,850.6875,764,858.6875,756,850.6875" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="752" x2="1158" y1="850.6875" y2="850.6875"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="370" x="776" y="808.2715">smartCardService.registerPlugin</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="216" x="784" y="840.9746">(new XXXFactory())</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="116" x="626" y="781.4688"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="88" x="640" y="824.5352">Plugin</text><polygon fill="#A80036" points="576,903.3906,556,911.3906,576,919.3906,568,911.3906" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="564" x2="672" y1="911.3906" y2="911.3906"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="72" x="588" y="901.6777">create</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="294" x="260" y="866.6875"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="266" x="274" y="909.7539">ObservableReader</text><polygon fill="#A80036" points="1136,955.9063,1156,963.9063,1136,971.9063,1144,963.9063" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="684" x2="1148" y1="963.9063" y2="963.9063"/><rect fill="#EEEEEE" height="6" style="stroke: #EEEEEE; stroke-width: 2.0;" width="3341" x="6" y="1022.2578"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="1022.2578" y2="1022.2578"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="1028.2578" y2="1028.2578"/><rect fill="#EEEEEE" height="48.7031" style="stroke: #000000; stroke-width: 4.0;" width="294" x="1529.5" y="999.9063"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="258" x="1541.5" y="1034.8965">Local CardSelection</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1264" y1="1113.3125" y2="1113.3125"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1264" x2="1264" y1="1113.3125" y2="1139.3125"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182" x2="1264" y1="1139.3125" y2="1139.3125"/><polygon fill="#A80036" points="1202,1131.3125,1182,1139.3125,1202,1147.3125,1194,1139.3125" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="260" x="1194" y="1103.5996">Start Ticketing Service</text><polygon fill="#A80036" points="716,1192.0156,696,1200.0156,716,1208.0156,708,1200.0156" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="704" x2="1158" y1="1200.0156" y2="1200.0156"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="206" x="728" y="1190.3027">getReader (name)</text><polygon fill="#A80036" points="1136,1252.7188,1156,1260.7188,1136,1268.7188,1144,1260.7188" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="684" x2="1148" y1="1260.7188" y2="1260.7188"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="72" x="698" y="1251.0059">reader</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1264" y1="1321.4219" y2="1321.4219"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1264" x2="1264" y1="1321.4219" y2="1347.4219"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182" x2="1264" y1="1347.4219" y2="1347.4219"/><polygon fill="#A80036" points="1202,1339.4219,1182,1347.4219,1202,1355.4219,1194,1347.4219" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="344" x="1194" y="1311.709">prepareCardSelection (reader)</text><polygon fill="#A80036" points="439,1400.125,419,1408.125,439,1416.125,431,1408.125" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="427" x2="1158" y1="1408.125" y2="1408.125"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="318" x="451" y="1398.4121">setCardSelectionRequest ()</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="393" x2="373" y1="1468.8281" y2="1460.8281"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="393" x2="373" y1="1468.8281" y2="1476.8281"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="101" x2="395" y1="1468.8281" y2="1468.8281"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="248" x="115" y="1459.1152">SE_MATCHED Event</text><polygon fill="#A80036" points="123,1521.5313,103,1529.5313,123,1537.5313,115,1529.5313" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="111" x2="395" y1="1529.5313" y2="1529.5313"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="98" x="135" y="1519.8184">C-APDU</text><polygon fill="#A80036" points="373,1582.2344,393,1590.2344,373,1598.2344,381,1590.2344" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="101" x2="385" y1="1590.2344" y2="1590.2344"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="98" x="115" y="1580.5215">R-APDU</text><polygon fill="#A80036" points="1136,1642.9375,1156,1650.9375,1136,1658.9375,1144,1650.9375" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="407" x2="1148" y1="1650.9375" y2="1650.9375"/><text fill="#FF0000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="421" y="1641.2246">smartCard</text><rect fill="#EEEEEE" height="6" style="stroke: #EEEEEE; stroke-width: 2.0;" width="3341" x="6" y="1709.2891"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="1709.2891" y2="1709.2891"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="1715.2891" y2="1715.2891"/><rect fill="#EEEEEE" height="48.7031" style="stroke: #000000; stroke-width: 4.0;" width="848" x="1252.5" y="1686.9375"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="812" x="1264.5" y="1721.9277">Execute Remote Service for a specific Observable Local Reader</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1264" y1="1800.3438" y2="1800.3438"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1264" x2="1264" y1="1800.3438" y2="1826.3438"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182" x2="1264" y1="1826.3438" y2="1826.3438"/><polygon fill="#A80036" points="1202,1818.3438,1182,1826.3438,1202,1834.3438,1194,1826.3438" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="254" x="1194" y="1790.6309">prepare userInputData</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1264" y1="1887.0469" y2="1887.0469"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1264" x2="1264" y1="1887.0469" y2="1913.0469"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1182" x2="1264" y1="1913.0469" y2="1913.0469"/><polygon fill="#A80036" points="1202,1905.0469,1182,1913.0469,1202,1921.0469,1194,1913.0469" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="332" x="1194" y="1877.334">LocalClientUtils.getService ()</text><polygon fill="#A80036" points="1714,2129.2656,1734,2137.2656,1714,2145.2656,1722,2137.2656" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1180" x2="1726" y1="2137.2656" y2="2137.2656"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="282" x="1194" y="1964.0371">executeRemoteService (</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="308" x="1202" y="1996.7402">RemoteServiceParameters</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="92" x="1218" y="2029.4434">.builder(</text><text fill="#0000FF" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="1310" y="2029.4434">serviceId</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="96" x="1424" y="2029.4434">, reader)</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="266" x="1218" y="2062.1465">.withInitialCardContent(</text><text fill="#FF0000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="1484" y="2062.1465">smartCard</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="8" x="1614" y="2062.1465">)</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="226" x="1218" y="2094.8496">.withUserInputData(</text><text fill="#008000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="1444" y="2094.8496">userInputData</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="94" x="1620" y="2094.8496">).build(),</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="282" x="1202" y="2127.5527">classOfUserOutputData)</text><polygon fill="#A80036" points="2040,2157.2656,2060,2165.2656,2040,2173.2656,2048,2165.2656" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1758" x2="2052" y1="2165.2656" y2="2165.2656"/><polygon fill="#A80036" points="2230,2217.9688,2250,2225.9688,2230,2233.9688,2238,2225.9688" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2084" x2="2242" y1="2225.9688" y2="2225.9688"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="72" x="2098" y="2216.2559">create</text><rect fill="#ADD8E6" height="63.2188" rx="10" ry="10" style="stroke: #A80036; stroke-width: 3.0;" width="498" x="2254" y="2181.2656"/><text fill="#000000" font-family="sans-serif" font-size="28" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="470" x="2268" y="2224.332">ObservableRemoteReaderServer</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3005" x2="2985" y1="2311.1875" y2="2303.1875"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3005" x2="2985" y1="2311.1875" y2="2319.1875"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2074" x2="3007" y1="2311.1875" y2="2311.1875"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="614" x="2088" y="2301.4746">notify (READER_CONNECTED, remoteReaderName)</text><polygon fill="#A80036" points="2106,2363.8906,2086,2371.8906,2106,2379.8906,2098,2371.8906" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2094" x2="3007" y1="2371.8906" y2="2371.8906"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="372" x="2118" y="2362.1777">getReader (remoteReaderName)</text><polygon fill="#A80036" points="2985,2424.5938,3005,2432.5938,2985,2440.5938,2993,2432.5938" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2074" x2="2997" y1="2432.5938" y2="2432.5938"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="162" x="2088" y="2422.8809">remoteReader</text><polygon fill="#A80036" points="2535,2485.2969,2515,2493.2969,2535,2501.2969,2527,2493.2969" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2523" x2="3007" y1="2493.2969" y2="2493.2969"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="164" x="2547" y="2483.584">getServiceId ()</text><polygon fill="#A80036" points="2985,2546,3005,2554,2985,2562,2993,2554" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2503" x2="2997" y1="2554" y2="2554"/><text fill="#0000FF" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="2517" y="2544.2871">serviceId</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3113" y1="2647.4063" y2="2647.4063"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3113" x2="3113" y1="2647.4063" y2="2673.4063"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3031" x2="3113" y1="2673.4063" y2="2673.4063"/><polygon fill="#A80036" points="3051,2665.4063,3031,2673.4063,3051,2681.4063,3043,2673.4063" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="244" x="3043" y="2604.9902">Find ticketing service</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="152" x="3043" y="2637.6934">to start using</text><text fill="#0000FF" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="3203" y="2637.6934">serviceId</text><rect fill="#EEEEEE" height="6" style="stroke: #EEEEEE; stroke-width: 2.0;" width="3341" x="6" y="2731.7578"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="2731.7578" y2="2731.7578"/><line style="stroke: #000000; stroke-width: 2.0;" x1="6" x2="3347" y1="2737.7578" y2="2737.7578"/><rect fill="#EEEEEE" height="48.7031" style="stroke: #000000; stroke-width: 4.0;" width="362" x="1495.5" y="2709.4063"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="326" x="1507.5" y="2744.3965">Remote Ticketing Service</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3113" y1="2822.8125" y2="2822.8125"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3113" x2="3113" y1="2822.8125" y2="2848.8125"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3031" x2="3113" y1="2848.8125" y2="2848.8125"/><polygon fill="#A80036" points="3051,2840.8125,3031,2848.8125,3051,2856.8125,3043,2848.8125" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="260" x="3043" y="2813.0996">Start Ticketing Service</text><polygon fill="#A80036" points="2535,2934.2188,2515,2942.2188,2535,2950.2188,2527,2942.2188" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2523" x2="3007" y1="2942.2188" y2="2942.2188"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="240" x="2547" y="2899.8027">getInitialCardContent</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="228" x="2555" y="2932.5059">(classOfSmartCard)</text><polygon fill="#A80036" points="2985,2994.9219,3005,3002.9219,2985,3010.9219,2993,3002.9219" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2503" x2="2997" y1="3002.9219" y2="3002.9219"/><text fill="#FF0000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="2517" y="2993.209">smartCard</text><polygon fill="#A80036" points="2535,3088.3281,2515,3096.3281,2535,3104.3281,2527,3096.3281" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2523" x2="3007" y1="3096.3281" y2="3096.3281"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="200" x="2547" y="3053.9121">getUserInputData</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="268" x="2555" y="3086.6152">(classOfUserInputData)</text><polygon fill="#A80036" points="2985,3149.0313,3005,3157.0313,2985,3165.0313,2993,3157.0313" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2503" x2="2997" y1="3157.0313" y2="3157.0313"/><text fill="#008000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="176" x="2517" y="3147.3184">userInputData</text><polygon fill="#A80036" points="2535,3209.7344,2515,3217.7344,2535,3225.7344,2527,3217.7344" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2523" x2="3007" y1="3217.7344" y2="3217.7344"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="210" x="2547" y="3208.0215">addObserver (this)</text><polygon fill="#A80036" points="2985,3237.7344,3005,3245.7344,2985,3253.7344,2993,3245.7344" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2503" x2="2997" y1="3245.7344" y2="3245.7344"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3113" y1="3306.4375" y2="3306.4375"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3113" x2="3113" y1="3306.4375" y2="3332.4375"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3031" x2="3113" y1="3332.4375" y2="3332.4375"/><polygon fill="#A80036" points="3051,3324.4375,3031,3332.4375,3051,3340.4375,3043,3332.4375" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="122" x="3043" y="3296.7246">continue...</text><path d="M36,3362.4375 L172,3362.4375 L172,3378.4375 L152,3398.4375 L26,3398.4375 L26,3372.4375 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.0;"/><rect fill="none" height="398.9219" rx="10" ry="10" style="stroke: #000000; stroke-width: 4.0;" width="3277" x="26" y="3362.4375"/><text fill="#000000" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="56" y="3391.4277">loop</text><text fill="#000000" font-family="sans-serif" font-size="22" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="194" x="202" y="3389.2754">[Card exchanges]</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3113" y1="3476.5469" y2="3476.5469"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3113" x2="3113" y1="3476.5469" y2="3502.5469"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3031" x2="3113" y1="3502.5469" y2="3502.5469"/><polygon fill="#A80036" points="3051,3494.5469,3031,3502.5469,3051,3510.5469,3043,3502.5469" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="236" x="3043" y="3434.1309">prepareCardRequest</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="178" x="3051" y="3466.834">(remoteReader)</text><polygon fill="#A80036" points="2535,3555.25,2515,3563.25,2535,3571.25,2527,3563.25" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2523" x2="3007" y1="3563.25" y2="3563.25"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="266" x="2547" y="3553.5371">processCardRequest ()</text><polygon fill="#A80036" points="123,3615.9531,103,3623.9531,123,3631.9531,115,3623.9531" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="111" x2="2491" y1="3623.9531" y2="3623.9531"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="98" x="135" y="3614.2402">C-APDU</text><polygon fill="#A80036" points="2469,3676.6563,2489,3684.6563,2469,3692.6563,2477,3684.6563" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="101" x2="2481" y1="3684.6563" y2="3684.6563"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="98" x="115" y="3674.9434">R-APDU</text><polygon fill="#A80036" points="2985,3737.3594,3005,3745.3594,2985,3753.3594,2993,3745.3594" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="2503" x2="2997" y1="3745.3594" y2="3745.3594"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="106" x="2517" y="3735.6465">response</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="3029" x2="3113" y1="3820.0625" y2="3820.0625"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3113" x2="3113" y1="3820.0625" y2="3846.0625"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="3031" x2="3113" y1="3846.0625" y2="3846.0625"/><polygon fill="#A80036" points="3051,3838.0625,3031,3846.0625,3051,3854.0625,3043,3846.0625" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="280" x="3043" y="3810.3496">prepare UserOutputData</text><polygon fill="#A80036" points="2106,3898.7656,2086,3906.7656,2106,3914.7656,2098,3906.7656" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2094" x2="3007" y1="3906.7656" y2="3906.7656"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="446" x="2118" y="3897.0527">terminateService (remoteReaderName,</text><text fill="#800080" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="2572" y="3897.0527">userOutputData</text><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="8" x="2768" y="3897.0527">)</text><line style="stroke: #A80036; stroke-width: 4.0;" x1="2467" x2="2487" y1="3957.4688" y2="3977.4688"/><line style="stroke: #A80036; stroke-width: 4.0;" x1="2467" x2="2487" y1="3977.4688" y2="3957.4688"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="2084" x2="2477" y1="3967.4688" y2="3967.4688"/><text fill="#000000" font-family="sans-serif" font-size="26" lengthAdjust="spacingAndGlyphs" textLength="362" x="2098" y="3957.7559">remove remote reader if needed</text><polygon fill="#A80036" points="1780,3987.4688,1760,3995.4688,1780,4003.4688,1772,3995.4688" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="1768" x2="2072" y1="3995.4688" y2="3995.4688"/><polygon fill="#A80036" points="1202,4048.1719,1182,4056.1719,1202,4064.1719,1194,4056.1719" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0; stroke-dasharray: 2.0,2.0;" x1="1190" x2="1746" y1="4056.1719" y2="4056.1719"/><text fill="#800080" font-family="sans-serif" font-size="26" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="1214" y="4046.459">userOutputData</text><text fill="#888888" font-family="sans-serif" font-size="20" lengthAdjust="spacingAndGlyphs" textLength="848" x="1252.5" y="4323.3711">Keyple Remote Plugin - RemotePluginServer API with an ObservableReader (03/11/2020)</text><!--MD5=[8b26ea24376b3223917f0ce521421018]
@startuml
footer
    Keyple Remote Plugin - RemotePluginServer API with an ObservableReader (03/11/2020)
end footer


skinparam Shadowing false
skinparam RoundCorner 10



participant "Card" as se

box "Client APP using Local Lib" #FEF9E7
participant "**ObservableReader**" as reader #LightBlue
participant "**Plugin**" as plugin #LightBlue
actor "**Ticketing Service**" as client
participant "**LocalServiceClient**" as localService #LightBlue
end box

box "Server APP using Remote Lib" #FDF2E9
participant "**RemotePluginServer**" as remotePlugin #LightBlue
participant "**ObservableRemoteReaderServer**" as remoteReader #LightBlue
actor "**Remote Ticketing Service**:\n**<back:LightBlue>ObservablePlugin.PluginObserver**" as server
end box

== Remote Lib Initialization ==

activate server #Pink
server -> remotePlugin ** : smartCardService.registerPlugin\n (RemotePluginServerFactory...\n    .withPluginObserver (this)...)
server -> server : Awaiting receipt of\n a Plugin Event...

== Local Lib Initialization ==

activate client #Pink
client -> localService ** : LocalServiceClientFactory...
client -> plugin ** : smartCardService.registerPlugin\n (new XXXFactory())
activate plugin #LightBlue
plugin -> reader ** : create
return

== Local CardSelection ==

client -> client : Start Ticketing Service
client -> plugin : getReader (name)
activate plugin #LightBlue
return reader
client -> client : prepareCardSelection (reader)
client -> reader : setCardSelectionRequest ()
activate reader #LightBlue

activate se #LightYellow
se ->> reader : SE_MATCHED Event
reader -> se : C-APDU
se - -> reader : R-APDU
return <color:red>**smartCard**</color>

== Execute Remote Service for a specific Observable Local Reader ==

client -> client : prepare userInputData

client -> client : LocalClientUtils.getService ()
client -> localService : executeRemoteService (\n RemoteServiceParameters\n   .builder(<color:blue>**serviceId**</color>, reader)\n   .withInitialCardContent(<color:red>**smartCard**</color>)\n   .withUserInputData(<color:green>**userInputData**</color>).build(),\n classOfUserOutputData)
activate localService #LightBlue

localService -> remotePlugin
activate remotePlugin #LightBlue
remotePlugin -> remoteReader ** : create
remotePlugin ->> server : notify (READER_CONNECTED, remoteReaderName)
deactivate remotePlugin

server -> remotePlugin : getReader (remoteReaderName)
activate remotePlugin #LightBlue
return remoteReader
server -> remoteReader : getServiceId ()
activate remoteReader #LightBlue
return <color:blue>**serviceId**</color>
server -> server : Find ticketing service\nto start using <color:blue>**serviceId**</color>

== Remote Ticketing Service ==

server -> server : Start Ticketing Service
server -> remoteReader : getInitialCardContent\n (classOfSmartCard)
activate remoteReader #LightBlue
return <color:red>**smartCard**</color>
server -> remoteReader : getUserInputData\n (classOfUserInputData)
activate remoteReader #LightBlue
return <color:green>**userInputData**</color>
server -> remoteReader : addObserver (this)
activate remoteReader #LightBlue
return
server -> server : continue...

loop #FDF2E9 Card exchanges
    server -> server : prepareCardRequest\n (remoteReader)
    server -> remoteReader : processCardRequest ()
    activate remoteReader #LightBlue
    remoteReader -> se : C-APDU
    se - -> remoteReader : R-APDU
    return response
end loop

server -> server : prepare UserOutputData
server -> remotePlugin : terminateService (remoteReaderName, <color:purple>**userOutputData**</color>)
activate remotePlugin #LightBlue
remotePlugin -x remoteReader : remove remote reader if needed

remotePlugin - -> localService
deactivate remotePlugin
localService - -> client : <color:purple>**userOutputData**</color>
deactivate localService

@enduml

PlantUML version 1.2020.09(Sun May 10 12:51:06 CEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.8+10-b944.34
Operating System: Windows 10
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>