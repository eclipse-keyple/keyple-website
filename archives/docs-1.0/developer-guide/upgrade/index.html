<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.6"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/wowchemy.4653a7440f94db38544ad5c255d616de.css><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=robots content="noindex"><meta name=description content="Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version. This guide is intended to help a user of a previous version of Keyple Java to upgrade his application to a new version of the library."><link rel=alternate hreflang=en-us href=https://keyple.org/archives/docs-1.0/developer-guide/upgrade/><link rel=canonical href=https://keyple.org/archives/docs-1.0/developer-guide/upgrade/><link rel=manifest href=../../../../manifest.webmanifest><link rel=icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1D87BB"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://keyple.org/media/logo.svg"><meta property="og:type" content="article"><meta property="og:site_name" content="Eclipse Keyple"><meta property="og:url" content="https://keyple.org/archives/docs-1.0/developer-guide/upgrade/"><meta property="og:title" content="Upgrade from an earlier version of Keyple | Eclipse Keyple"><meta property="og:description" content="Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version. This guide is intended to help a user of a previous version of Keyple Java to upgrade his application to a new version of the library."><meta property="og:image" content="https://keyple.org/media/logo.svg"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2024-05-03T09:28:52+02:00"><title>Upgrade from an earlier version of Keyple | Eclipse Keyple</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=0346b94fc96babbec3fdf675808b8e5b><script src=../../../../js/wowchemy-init.min.d66af272089c6c0601f1a57edc3bf6ab.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple速</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../what-is-keyple/overview/><span>Overview</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/why-trust/><span>Why trust Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=../../../../#adopters><span>Who is using Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/what-is-calypso/><span>What is Calypso速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=../../../../#news><span>News</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../learn/overview><span>Learn</span></a></li><li class=nav-item><a class=nav-link href=../../../../components/overview><span>Components</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Community</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../adopters-and-testimonials/><span>Adopters & Testimonials</span></a>
<a class=dropdown-item href=../../../../community/contributing/><span>Contributing</span></a>
<a class=dropdown-item href=../../../../community/roadmap/><span>Roadmap</span></a>
<a class=dropdown-item href=../../../../community/changelog/><span>Changelog</span></a>
<a class=dropdown-item href=../../../../project-dashboard/><span>Project dashboard</span></a>
<a class=dropdown-item href=../../../../statistics/><span>Statistics</span></a>
<a class=dropdown-item href="https://sonarcloud.io/organizations/eclipse/projects?search=keyple&amp;sort=-analysis_date"><span>Code quality dashboard</span></a>
<a class=dropdown-item href=https://projects.eclipse.org/projects/iot.keyple/><span>Eclipse Foundation Keyple page</span></a>
<a class=dropdown-item href=https://accounts.eclipse.org/mailing-list/keyple-dev/><span>Mailing list</span></a>
<a class=dropdown-item href=https://github.com/eclipse-keyple/keyple/><span>GitHub home repository</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../external-resources/><span>External resources</span></a></li><li class=nav-item><a class=nav-link href=../../../../learn/build-your-first-app/><button class='btn btn-info'><i class='fas fa-rocket pr-1' aria-hidden=true></i> <span>START CODING</span></button></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Developer guides
</span><span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=../../../../archives/></a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/>== Docs 1.x ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/build-your-first-app/>Build your first app</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/build-your-first-app/java-app/>Java</a></li><li><a href=../../../../archives/docs-1.0/build-your-first-app/android-app/>Android</a></li><li><a href=../../../../archives/docs-1.0/build-your-first-app/cpp-app/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/developer-guide/>Developer guides</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/developer-guide/common-concepts/>Common concepts</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/standalone-application/>Standalone application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/distributed-application/>Distributed application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/calypso-application/>Calypso application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-plugin/>Create a plugin</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-extension/>Create an extension</a></li><li class=active><a href=../../../../archives/docs-1.0/developer-guide/upgrade/>Upgrade Keyple</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/api-reference/>API reference</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/api-reference/java-api/>Java</a></li><li><a href=../../../../archives/docs-1.0/api-reference/cpp-api/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/architecture/>Architecture</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/architecture/keyple-global/>Global Solution</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-core/>Keyple Core</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-calypso/>Keyple Calypso</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/>== Java 1.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/distributed-systems/>Distributed systems</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/distributed-systems/local/>Local</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/network/>Network</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/remote/>Remote</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/plugins/nfc/>NFC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/omapi/>OMAPI</a></li><li><a href=../../../../archives/components-java-1.0/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/stub/>Stub</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/>== C++ 0.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-cpp-0.9/plugins/stub/>Stub</a></li></ul></div></ul></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#upgrade-from-090-to-100>Upgrade from 0.9.0 to 1.0.0</a><ul><li><a href=#whats-changed>What&rsquo;s changed?</a></li></ul></li><li><a href=#upgrade-from-081-to-090>Upgrade from 0.8.1 to 0.9.0</a><ul><li><a href=#whats-changed-1>What&rsquo;s changed?</a></li><li><a href=#plugin-registration-in-the-seproxyservice>Plugin registration in the SeProxyService</a></li><li><a href=#preparation-of-selection-cases>Preparation of selection cases</a></li><li><a href=#retrieving-selection-results>Retrieving selection results</a></li><li><a href=#definition-of-the-security-settings-of-the-transaction>Definition of the security settings of the transaction</a></li><li><a href=#creation-of-the-potransaction-object>Creation of the PoTransaction object</a></li><li><a href=#transaction-commands-preparation>Transaction commands preparation</a></li><li><a href=#transaction-commands-processing>Transaction commands processing</a></li><li><a href=#retrieving-data-read-from-pos>Retrieving data read from POs</a></li></ul></li><li><a href=#error-handling>Error handling</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container></div><div class=docs-article-container><h1>Upgrade from an earlier version of Keyple</h1><article class=article-style><div class="alert alert-warning"><div>Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version.</div></div><p>This guide is intended to help a user of a previous version of Keyple Java to upgrade his application to a new version of the library.</p><p>Upgrade from:</p><ul><li><a href=#upgrade-from-090-to-100>0.9.0 to 1.0.0</a></li><li><a href=#upgrade-from-081-to-090>0.8.1 to 0.9.0</a></li></ul><p>Note: here we describe the evolutions in broad outline, for the details of the APIs, the reader is invited to consult
the <a href=https://keyple.org/archives/docs-1.0/api-reference/>API reference</a> section.</p><br><h2 id=upgrade-from-090-to-100>Upgrade from 0.9.0 to 1.0.0</h2><h3 id=whats-changed>What&rsquo;s changed?</h3><p>Compared to version 0.9, the goal of Keyple 1.0 is mainly to fix bugs,
add features to make Keyple more robust and rename/reorganize classes to make it easier to learn.</p><ul><li><a href=#class-renaming>Renamings</a></li><li><a href=#internal-exception-handling>Internal exception handling</a></li><li><a href=#pcsc-plugin>PC/SC plugin</a></li><li><a href=#keyple-distributed>Keyple Distributed</a></li></ul><h4 id=class-renaming>Class renaming</h4><table><thead><tr><th>Module</th><th>Old name (0.9.0)</th><th>New name (1.0.0)</th></tr></thead><tbody><tr><td>Keyple Core</td><td>SeProxyService</td><td>SmartCardService</td></tr><tr><td>Keyple Core</td><td>ReaderPlugin</td><td>Plugin</td></tr><tr><td>Keyple Core</td><td>SeReader</td><td>Reader</td></tr><tr><td>Keyple Core</td><td>ReaderPoolPlugin</td><td>PoolPlugin</td></tr><tr><td>Keyple Core</td><td>SeSelection</td><td>CardSelectionService</td></tr><tr><td>Keyple Core</td><td>SeSelector</td><td>CardSelector</td></tr><tr><td>Keyple Core</td><td>AbstractMatchingSe</td><td>AbstractSmartCard</td></tr><tr><td>Keyple Calypso</td><td>PoSelectionRequest</td><td>PoSelection</td></tr><tr><td>Keyple Calypso</td><td>SamSelectionRequest</td><td>SamSelection</td></tr></tbody></table><h4 id=internal-exception-handling>Internal exception handling</h4><p>New possibilities have been added in the management of observable objects (<em>Plugin</em> and <em>Reader</em>).</p><p>If the Plugin or Reader is observable, it is now necessary to define exception handlers that will be called by the internal layers of Keyple in the case of an exception raised by an observation process.</p><p>Two new interfaces have been added to the <em>event</em> package to allow applications via the factories of the concerned plugins to define the method that will be called when needed:</p><ul><li><code>PluginObservationExceptionHandler</code></li><li><code>ReaderObservationExceptionHandler</code></li></ul><p>These handlers are usually provided by the application via the constructor of the plugin&rsquo;s factory.</p><h4 id=pcsc-plugin>PC/SC plugin</h4><p>The generic parameterization interface for plugins and readers has been removed in favor of methods specific to each plugin.</p><p>In the case of the PC/SC plugin, the following methods have appeared:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>PcscPlugin</td><td><code>setReaderNameFilter</code></td></tr><tr><td>PcscPlugin</td><td><code>setProtocolIdentificationRule</code></td></tr><tr><td>PcscReader</td><td><code>setSharingMode</code></td></tr><tr><td>PcscReader</td><td><code>setContactless</code></td></tr><tr><td>PcscReader</td><td><code>setIsoProtocol</code></td></tr><tr><td>PcscReader</td><td><code>setDisconnectionMode</code></td></tr></tbody></table><h4 id=keyple-distributed>Keyple Distributed</h4><p>The use of Keyple in a remote context has been extensively reviewed and its description is beyond the scope of this guide. Please refer to the <a href=../../../../archives/docs-1.0/developer-guide/distributed-application/>distributed application</a> section.</p><hr><h2 id=upgrade-from-081-to-090>Upgrade from 0.8.1 to 0.9.0</h2><h3 id=whats-changed-1>What&rsquo;s changed?</h3><p>From a user API point of view, the changes relate to the following topics:
From a user API point of view, the changes relate to the following topics:</p><ul><li><a href=#plugin-registration-in-the-seproxyservice>plugin registration in the SeProxyService</a></li><li><a href=#preparation-of-selection-cases>preparation of selection cases</a></li><li><a href=#retrieving-selection-results>retrieving selection results</a></li><li><a href=#definition-of-the-security-settings-of-the-transaction>definition of the security settings of the transaction</a></li><li><a href=#creation-of-the-potransaction-object>creation of the PoTransaction object</a></li><li><a href=#transaction-commands-preparation>transaction commands preparation</a></li><li><a href=#transaction-commands-processing>transaction commands processing</a></li><li><a href=#retrieving-data-read-from-pos>retrieving data read from POs</a></li><li><a href=#error-handling>error handling</a></li></ul><h3 id=plugin-registration-in-the-seproxyservice>Plugin registration in the SeProxyService</h3><p>The <code>registerPlugin</code> method of the <code>SeProxyService</code> class now returns the reference of the registered plugin.</p><p>This makes it possible, for example, to perform a reader setup in an application such as this one:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>   </span><span class=c1>// Create a PcscPlugin and register it into the SeProxyService</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>ReaderPlugin</span><span class=w> </span><span class=n>pcscPlugin</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>seProxyService</span><span class=p>.</span><span class=na>registerPlugin</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PcscPluginFactory</span><span class=p>());</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=c1>// Get the PO reader from the plugin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>SeReader</span><span class=w> </span><span class=n>poReader</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pcscPlugin</span><span class=p>.</span><span class=na>getReader</span><span class=p>(</span><span class=s>&#34;ASK LoGO 0&#34;</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=preparation-of-selection-cases>Preparation of selection cases</h3><p>The <code>AidSelector</code>, <code>Selector</code> and <code>PoSelector</code> classes now follow the Fluent Builder pattern for better handling of optional parameters.</p><p>The construction of an <code>AidSelector</code> is as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>AidSelector</span><span class=w> </span><span class=n>appAidSelector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AidSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>aidToSelect</span><span class=p>(</span><span class=n>AID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>fileControlInformation</span><span class=p>(</span><span class=n>AidSelector</span><span class=p>.</span><span class=na>FileControlInformation</span><span class=p>.</span><span class=na>FCI</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>fileOccurrence</span><span class=p>(</span><span class=n>AidSelector</span><span class=p>.</span><span class=na>FileOccurrence</span><span class=p>.</span><span class=na>FIRST</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>The <code>fileControlInformation</code> and <code>fileOccurrence</code> fields are optional (shown here with their default values), so a simple version can be :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>AidSelector</span><span class=w> </span><span class=n>aidSelector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>AidSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>aidToSelect</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>AID</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>The construction of a <code>SeSelector</code> is as follows:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>seSelector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SeSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>seProtocol</span><span class=p>(</span><span class=n>SeCommonProtocols</span><span class=p>.</span><span class=na>PROTOCOL_ISO14443_4</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>aidSelector</span><span class=p>(</span><span class=n>appAidSelector</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>The <code>PoSelector</code> adds the possibility to specify that an invalidated PO should be processed</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>seSelector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SeSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>seProtocol</span><span class=p>(</span><span class=n>SeCommonProtocols</span><span class=p>.</span><span class=na>PROTOCOL_ISO14443_4</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>aidSelector</span><span class=p>(</span><span class=n>appAidSelector</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>invalidatedPo</span><span class=p>(</span><span class=n>InvalidatedPo</span><span class=p>.</span><span class=na>ACCEPT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>The management of PO commands to be performed after the selection step (when it has been successful) is handled by the methods of the <code>PoSelectionRequest</code> class:</p><ul><li>preparing to read files has been simplified and is done using the unique following method:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareReadRecordFile</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>recordNumber</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><ul><li>preparing to select files is done using the following method:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareSelectFile</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>lid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareSelectFile</span><span class=p>(</span><span class=kt>short</span><span class=w> </span><span class=n>lid</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>Note that from now the &ldquo;prepare&rdquo; methods no longer return indexes, the data will be placed in the CalypsoPo object.</p><h3 id=retrieving-selection-results>Retrieving selection results</h3><p>The <code>MatchingSelection</code> class no longer exists.
In the class <code>SelectionsResult</code> (see <code>processDefaultSelection/processExplicitSelection</code>):</p><ul><li><p><code>getActiveSelection</code> is replaced by <code>getActiveMatchingSe</code> which returns an <code>AbstractMatchingSe</code> object (the still existing <code>hasActiveSelection</code> method must be used before)</p></li><li><p><code>getMatchingSelection</code> is replaced by <code>getMatchingSe</code> which returns an <code>AbstractMatchingSe</code> object (may be null if the index provided does not correspond to a successful selection case)</p></li><li><p><code>getMatchingSelections</code> now returns a Map containing a list of associated <code>AbstractMatchingSe</code> with the selection index that produced it (<code>Map&lt;Integer, AbstractMatchingSe></code>)</p></li><li><p>a new <code>hasSelectionMatched</code> method indicates whether the selection index provided corresponds to a successful selection case</p></li><li><p>a new <code>getActiveSelectionIndex</code> method returns the index of the active selection (the still existing <code>hasActiveSelection</code> method must be used before)</p></li></ul><h3 id=definition-of-the-security-settings-of-the-transaction>Definition of the security settings of the transaction</h3><p>These parameters are defined via the <code>PoSecuritySettings</code> class, whose construction now follows the Fluent Builder pattern.</p><p>All parameters are optional except the <code>SamResource</code>.</p><p>Here is an example of a complete <code>PoSecuritySettings</code> build:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>poSecuritySettings</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PoSecuritySettings</span><span class=p>.</span><span class=na>PoSecuritySettingsBuilder</span><span class=p>(</span><span class=n>samResource</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKif</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_PERSO</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KIF_PERSO</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKif</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_LOAD</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KIF_LOAD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKif</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_DEBIT</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KIF_DEBIT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKeyRecordNumber</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_PERSO</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KEY_RECORD_NUMBER_PERSO</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKeyRecordNumber</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_LOAD</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KEY_RECORD_NUMBER_LOAD</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionDefaultKeyRecordNumber</span><span class=p>(</span><span class=n>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_DEBIT</span><span class=p>,</span><span class=w> </span><span class=n>DEFAULT_KEY_RECORD_NUMBER_DEBIT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionModificationMode</span><span class=p>(</span><span class=n>ModificationMode</span><span class=p>.</span><span class=na>ATOMIC</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>ratificationMode</span><span class=p>(</span><span class=n>RatificationMode</span><span class=p>.</span><span class=na>CLOSE_RATIFIED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>sessionAuthorizedKvcList</span><span class=p>(</span><span class=n>authKvcs</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><h3 id=creation-of-the-potransaction-object>Creation of the PoTransaction object</h3><p>Since PoSecuritySettings now integrates SamResource, the construction of PoTransaction has evolved slightly.</p><p>Here is an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>PoTransaction</span><span class=w> </span><span class=n>poTransaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PoTransaction</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>PoResource</span><span class=p>(</span><span class=n>poReader</span><span class=p>,</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>),</span><span class=w> </span><span class=n>poSecuritySettings</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=transaction-commands-preparation>Transaction commands preparation</h3><p>Just as with the &ldquo;prepare&rdquo; commands used for selection, the &ldquo;prepare&rdquo; commands used for transactions no longer return indexes.</p><p>The available commands in version 0.9 are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareSelectFile</span><span class=p>(</span><span class=n>SelectFileControl</span><span class=w> </span><span class=n>control</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareSelectFile</span><span class=p>(</span><span class=kt>short</span><span class=w> </span><span class=n>lid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareSelectFile</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>lid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareReadRecordFile</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>recordNumber</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareReadRecordFile</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>firstRecordNumber</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>numberOfRecords</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>recordSize</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareReadCounterFile</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>countersNumber</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareUpdateRecord</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>recordNumber</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>recordData</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareWriteRecord</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>recordNumber</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>recordData</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareAppendRecord</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>recordData</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareIncreaseCounter</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>counterNumber</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>incValue</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>prepareDecreaseCounter</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>counterNumber</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>decValue</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=transaction-commands-processing>Transaction commands processing</h3><p>The &ldquo;process&rdquo; commands have also been revised and simplified.</p><p>They all return <code>void</code>.</p><p>In case of failure a exception is raised (see below).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processOpening</span><span class=p>(</span><span class=n>PoTransaction</span><span class=p>.</span><span class=na>SessionSetting</span><span class=p>.</span><span class=na>AccessLevel</span><span class=w> </span><span class=n>accessLevel</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p>The <code>ModificationMode</code> is no longer required since it is integrated in the <code>PoSecuritySettings</code>.</p><p>Parameters previously used to specify that a file is read at login are removed.</p><p>Instead, the first prepareReadFile command will be automatically taken into account.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processPoCommands</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processPoCommandsInSession</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processCancel</span><span class=p>(</span><span class=n>ChannelControl</span><span class=w> </span><span class=n>channelControl</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>processClosing</span><span class=p>(</span><span class=n>ChannelControl</span><span class=w> </span><span class=n>channelControl</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=retrieving-data-read-from-pos>Retrieving data read from POs</h3><p>This is a major evolution of the Keyple API. Previously, data read from Calyspo POs were retrieved by applications using &ldquo;parser&rdquo; methods.</p><p>With Keyple API 0.9, Calypso PO data is made available in the CalypsoPo object obtained during selection and enriched all along the operations performed with PoTransaction.</p><p>The public getter methods of CalypsoPo are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getDfName</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getDfNameBytes</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getApplicationSerialNumber</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getApplicationSerialNumberBytes</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getAtr</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getStartupInfo</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>PoRevision</span><span class=w> </span><span class=nf>getRevision</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getSessionModification</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getApplicationType</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getApplicationSubtype</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getPlatform</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getSoftwareIssuer</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getSoftwareVersion</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getSoftwareRevision</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isDeselectRatificationSupported</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isConfidentialSessionModeSupported</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isPublicAuthenticationSupported</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isPinFeatureAvailable</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isSvFeatureAvailable</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isDfInvalidated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isDfRatified</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>DirectoryHeader</span><span class=w> </span><span class=nf>getDirectoryHeader</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ElementaryFile</span><span class=w> </span><span class=nf>getFileBySfi</span><span class=p>(</span><span class=kt>byte</span><span class=w> </span><span class=n>sfi</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>ElementaryFile</span><span class=w> </span><span class=nf>getFileByLid</span><span class=p>(</span><span class=kt>short</span><span class=w> </span><span class=n>lid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>Byte</span><span class=p>,</span><span class=w> </span><span class=n>ElementaryFile</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllFiles</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><p>Four new classes <code>DirectoryHeader</code>, <code>ElementaryFile</code>, <code>FileHeader</code> and <code>FileData</code> have been added.</p><h5 id=directoryheader>DirectoryHeader</h5><p>The public getters for this class are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>short</span><span class=w> </span><span class=nf>getLid</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getAccessConditions</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getKeyIndexes</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getDfStatus</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getKif</span><span class=p>(</span><span class=n>AccessLevel</span><span class=w> </span><span class=n>level</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getKvc</span><span class=p>(</span><span class=n>AccessLevel</span><span class=w> </span><span class=n>level</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><h5 id=elementaryfile>ElementaryFile</h5><p>The public getters for this class are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getSfi</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>FileHeader</span><span class=w> </span><span class=nf>getHeader</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>FileData</span><span class=w> </span><span class=nf>getData</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><h5 id=fileheader>FileHeader</h5><p>The public getters for this class are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>short</span><span class=w> </span><span class=nf>getLid</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getRecordsNumber</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getRecordSize</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>FileType</span><span class=w> </span><span class=nf>getType</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=w> </span><span class=nf>getDfStatus</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>isShared</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>Short</span><span class=w> </span><span class=nf>getSharedReference</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getAccessConditions</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getKeyIndexes</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><h5 id=filedata>FileData</h5><p>The public getters for this class are:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getContent</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getContent</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>numRecord</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=nf>getContent</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>numRecord</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>dataOffset</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>dataLength</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>SortedMap</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;</span><span class=w> </span><span class=nf>getAllRecordsContent</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>getContentAsCounterValue</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>numCounter</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>SortedMap</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=w> </span><span class=n>Integer</span><span class=o>&gt;</span><span class=w> </span><span class=nf>getAllCountersValue</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><p>So, for example to extract the contents of contract files present in the PO, the code might look like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>[</span><span class=p>...</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/* Read all 4 contracts command, record size set to 29 */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>prepareReadRecordFile</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>SFI_Contracts</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>RECORD_NUMBER_1</span><span class=p>,</span><span class=w> </span><span class=n>4</span><span class=p>,</span><span class=w> </span><span class=n>29</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/* proceed with the sending of commands, don&#39;t close the channel */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>processPoCommandsInSession</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ElementaryFile</span><span class=w> </span><span class=n>efContracts</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getFileBySfi</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>SFI_Contracts</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SortedMap</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>records</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>efContracts</span><span class=p>.</span><span class=na>getData</span><span class=p>().</span><span class=na>getAllRecordsContent</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=w> </span><span class=kt>byte</span><span class=o>[]&gt;</span><span class=w> </span><span class=n>entry</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=n>records</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&#34;Contract #{}: {}&#34;</span><span class=p>,</span><span class=w> </span><span class=n>entry</span><span class=p>.</span><span class=na>getKey</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>ByteArrayUtil</span><span class=p>.</span><span class=na>toHex</span><span class=p>(</span><span class=n>entry</span><span class=p>.</span><span class=na>getValue</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>[</span><span class=p>...</span><span class=o>]</span><span class=w>
</span></span></span></code></pre></div><h2 id=error-handling>Error handling</h2><p>Since version 0.9, all Keyple exceptions are of the RuntimeException type.</p><p>Catching exceptions is therefore now optional.</p><p>However, it is possible to selectively catch certain exceptions in order to deal with particular cases.</p><p>The new hierarchy of Keyple exceptions is shown <a href="https://keyple.atlassian.net/projects/KEYP/issues/KEYP-154?filter=allissues&amp;orderby=priority%20DESC&amp;keyword=exceptions" target=_blank rel=noopener>here</a></p></article><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=../../../../archives/docs-1.0/developer-guide/create-extension/ rel=next>Create an extension</a></div></div></div></div><div class=body-footer><p>Last updated on 2024-05-03</p></div><footer class=site-footer><div class=container><div class="row featurette"><div class="col-12 col-sm-4"><p style=color:#fff><b>ECLIPSE LEGAL</b></p><a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a><br><a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a><br><a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a><br><a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a><br><a href=https://www.eclipse.org/legal/>Legal Resources</a><br><a href=https://eclipse.org/security/ target=_blank>Report a Vulnerability</a><br></div><div class="col-12 col-sm-4"><a href=https://www.eclipse.org target=_blank><img src=../../../../media/eclipse_foundation_logo.svg id=logo-eclipse-foundation></a></div><div class="col-12 col-sm-4"><a href=https://iot.eclipse.org target=_blank><img src=../../../../media/eclipse_iot_logo.svg id=logo-eclipse-iot></a></div></div></div><p class="powered-by copyright-license-text">息 2019-2024 The Eclipse Keyple速 project. All Rights Reserved.</p><p class=powered-by id=template-info>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a>  the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></main></div></div></div><div class=page-footer></div><script src=../../../../js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js integrity="sha256-aQmOEF2ZD4NM/xt4hthzREIo/2PFkOX/g01WjxEV7Ys=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=../../../../en/js/wowchemy.min.d4ae7854d9b0e4fbddb918c16a3e77d6.js></script><script src=../../../../js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><link rel=stylesheet href=https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css><script src=https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js></script><script src=https://d3js.org/d3.v6.min.js></script></body></html>