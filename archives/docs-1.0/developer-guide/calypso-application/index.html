<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.6"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/wowchemy.9988b35ac5894e443b66b1f843adb91e.css><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=robots content="noindex"><meta name=description content="Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version. Overview Keyple API was designed to support an extension system."><link rel=alternate hreflang=en-us href=https://keyple.org/archives/docs-1.0/developer-guide/calypso-application/><link rel=canonical href=https://keyple.org/archives/docs-1.0/developer-guide/calypso-application/><link rel=manifest href=../../../../manifest.webmanifest><link rel=icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1D87BB"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://keyple.org/media/logo.svg"><meta property="og:type" content="article"><meta property="og:site_name" content="Eclipse Keyple"><meta property="og:url" content="https://keyple.org/archives/docs-1.0/developer-guide/calypso-application/"><meta property="og:title" content="Calypso application | Eclipse Keyple"><meta property="og:description" content="Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version. Overview Keyple API was designed to support an extension system."><meta property="og:image" content="https://keyple.org/media/logo.svg"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2025-03-06T14:02:36+01:00"><title>Calypso application | Eclipse Keyple</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=162010b341eb030c88deade634ea9d10><script src=../../../../js/wowchemy-init.min.d66af272089c6c0601f1a57edc3bf6ab.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple速</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../what-is-keyple/overview/><span>Overview</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/why-trust/><span>Why trust Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=../../../../#adopters><span>Who is using Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/what-is-calypso/><span>What is Calypso速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=../../../../#news><span>News</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../learn/overview><span>Learn</span></a></li><li class=nav-item><a class=nav-link href=../../../../components/overview><span>Components</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Community</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../adopters-and-testimonials/><span>Adopters & Testimonials</span></a>
<a class=dropdown-item href=../../../../community/licenses/><span>Licenses</span></a>
<a class=dropdown-item href=../../../../community/contributing/><span>Contributing</span></a>
<a class=dropdown-item href=../../../../community/roadmap/><span>Roadmap</span></a>
<a class=dropdown-item href=../../../../community/maintenance/><span>Maintenance</span></a>
<a class=dropdown-item href=../../../../community/changelog/><span>Changelog</span></a>
<a class=dropdown-item href=../../../../statistics/><span>Statistics</span></a>
<a class=dropdown-item href=../../../../project-dashboard/><span>Project dashboard</span></a>
<a class=dropdown-item href="https://sonarcloud.io/organizations/eclipse/projects?search=keyple&amp;sort=-analysis_date"><span>Code quality dashboard</span></a>
<a class=dropdown-item href=https://projects.eclipse.org/projects/iot.keyple/><span>Eclipse Foundation Keyple page</span></a>
<a class=dropdown-item href=https://accounts.eclipse.org/mailing-list/keyple-dev/><span>Mailing list</span></a>
<a class=dropdown-item href=https://github.com/eclipse-keyple/><span>GitHub home repository</span></a>
<a class=dropdown-item href=https://docs.keyple.org/><span>All APIs docs</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../external-resources/><span>External resources</span></a></li><li class=nav-item><a class=nav-link href=../../../../learn/build-your-first-app/><button class='btn btn-info'><i class='fas fa-rocket pr-1' aria-hidden=true></i> <span>START CODING</span></button></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Developer guides
</span><span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=../../../../archives/></a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/>== Docs 1.x ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/build-your-first-app/>Build your first app</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/build-your-first-app/java-app/>Java</a></li><li><a href=../../../../archives/docs-1.0/build-your-first-app/android-app/>Android</a></li><li><a href=../../../../archives/docs-1.0/build-your-first-app/cpp-app/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/developer-guide/>Developer guides</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/developer-guide/common-concepts/>Common concepts</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/standalone-application/>Standalone application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/distributed-application/>Distributed application</a></li><li class=active><a href=../../../../archives/docs-1.0/developer-guide/calypso-application/>Calypso application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-plugin/>Create a plugin</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-extension/>Create an extension</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/upgrade/>Upgrade Keyple</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/api-reference/>API reference</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/api-reference/java-api/>Java</a></li><li><a href=../../../../archives/docs-1.0/api-reference/cpp-api/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/architecture/>Architecture</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/architecture/keyple-global/>Global Solution</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-core/>Keyple Core</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-calypso/>Keyple Calypso</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/>== Java 1.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/distributed-systems/>Distributed systems</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/distributed-systems/local/>Local</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/network/>Network</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/remote/>Remote</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/plugins/nfc/>NFC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/omapi/>OMAPI</a></li><li><a href=../../../../archives/components-java-1.0/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/stub/>Stub</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/>== C++ 0.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-cpp-0.9/plugins/stub/>Stub</a></li></ul></div></ul></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#before-you-start>Before you start</a></li><li><a href=#concepts>Concepts</a><ul><li><a href=#calypso-po>Calypso PO</a></li><li><a href=#elementaryfile>ElementaryFile</a></li><li><a href=#calypso-sam>Calypso SAM</a></li><li><a href=#posecuritysettings>PoSecuritySettings</a></li></ul></li><li><a href=#basic-operations>Basic Operations</a><ul><li><a href=#poselection>PoSelection</a></li></ul></li><li><a href=#samselection>SamSelection</a><ul><li><a href=#potransaction>PoTransaction</a></li></ul></li><li><a href=#examples>Examples</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container></div><div class=docs-article-container><h1>Calypso application</h1><article class=article-style><div class="alert alert-warning"><div>Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version.</div></div><h2 id=overview>Overview</h2><p>Keyple API was designed to support an extension system. On top of <strong>Keyple Core</strong>, APIs can be developed to extend
Keyple features. For example, Calypso Network Association provides <strong>Keyple Calypso Extension</strong>.</p><p>The use of <strong>Keyple Calypso Extension</strong> open the ability to operate commands with a Calypso Portable Object and to manage a
secure Calypso transaction seamlessly. It completely hides the details of the APDU commands that are sent to POs and SAMs, which are usually tedious operations.</p><p>The diagram below shows the role of the <strong>Keyple Calypso Extension</strong> components in the software layers for a standalone application :</p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=../../../../media/archive-1.0/calypso-app-development/component/Local_Component_Overview.svg alt loading=lazy data-zoomable></div></div></figure><h2 id=before-you-start>Before you start</h2><ol><li>In pre-requisite, have knowledge of the standard Calypso.</li><li>Read the <a href=../../../../archives/docs-1.0/developer-guide/common-concepts/>common concepts</a> page and become familiar with the basic concepts on which Keyple is based.</li><li>Any implementation of a Keyple application starts with the implementation of <strong>Keyple Core</strong>, please study the <a href=../../../../archives/docs-1.0/developer-guide/standalone-application/>workflow</a> proposed in Standalone application guide.</li><li>Read chapter <a href=#concepts>Concepts</a> to understand the main terms and concepts of the <strong>Keyple Calypso Extension</strong> API.</li><li>Explore the <a href=#keyplecalypsoapi>Keyple Calypso API</a> to discover all the possibilities offered by <strong>Keyple Calypso Extension</strong>.</li><li>Take inspiration from the <a href=#examples>examples</a>.</li><li>Follow the explanations given in the <a href=https://keyple.org/archives/docs-1.0/build-your-first-app/>Build your first app</a> section to configure your environment.</li><li>Using the <a href=https://keyple.org/archives/components-java-1.0/core/>Java components</a> or <a href=https://keyple.org/archives/components-cpp-0.9/core/>C++ components</a> pages, import <strong>Keyple Core</strong> into your project.</li><li>Using the <a href=https://keyple.org/archives/components-java-1.0/extensions/calypso/>Java components</a> or <a href=https://keyple.org/archives/components-cpp-0.9/extensions/calypso/>C++ components</a> pages, import <strong>Keyple Calypso Extension</strong> into your project.</li><li>Start playing with Keyple.</li></ol><h2 id=concepts>Concepts</h2><p>Here are the main concepts to keep in mind before continuing to read this user guide :</p><h3 id=calypso-po>Calypso PO</h3><p>Concentrates all known information about the Personal Object being processed. Accessible information are</p><ul><li>The application identification fields (revision/version, class, DF name, serial number, ATR, issuer)</li><li>The indication of the presence of optional features (Stored Value, PIN, Rev3.2 mode, ratification management)</li><li>The management information of the session modifications buffer</li><li>The invalidation status</li><li>The files, counters, SV data read or modified during the execution of the processes defined by PoTransaction</li></ul><p>The Calypso PO fields are first populated from the CardSelectionResponse obtained through the PO selection process then each time a PoTransaction &ldquo;process&rdquo; method is called.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Retrieve PO&#39;s informations</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>atr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getAtr</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>applicationSerial</span><span class=o>+</span><span class=n>Number</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getApplicationSerialNumber</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//SFI_EventLog = 0x08</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ElementaryFile</span><span class=w> </span><span class=n>efEventLog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getFileBySfi</span><span class=p>(</span><span class=n>SFI_EventLog</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//SFI_EnvironmentAndHolder = 0x07</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ElementaryFile</span><span class=w> </span><span class=n>efEnvironmentAndHolder</span><span class=w> </span><span class=o>=</span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getFileBySfi</span><span class=p>(</span><span class=n>SFI_EnvironmentAndHolder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h3 id=elementaryfile>ElementaryFile</h3><p>Object containing the description of a Calypso Elementary File. Can be retrieved from Calypso PO using its SFI.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ElementaryFile</span><span class=w> </span><span class=n>efEventLog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getFileBySfi</span><span class=p>(</span><span class=n>SFI_EventLog</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Read data content of sevent log elemenatary file</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>eventLog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteArrayUtil</span><span class=p>.</span><span class=na>toHex</span><span class=p>(</span><span class=n>efEventLog</span><span class=p>.</span><span class=na>getData</span><span class=p>().</span><span class=na>getContent</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h3 id=calypso-sam>Calypso SAM</h3><p>Concentrates all the informations we know about the SAM currently selected. Accessible informations are:</p><ul><li>The Sam Revision</li><li>The Serial number</li><li>The Platform identifier</li><li>The Application Type</li><li>The Application SubType</li><li>The Software Issuer identifier</li><li>The Software Version number</li><li>The Software Revision number</li></ul><p>Calypso SAM fields are populated by analysis of the ATR within a CardSelectionResponse obtained through the SAM selection process.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>serialNumber</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoSam</span><span class=p>.</span><span class=na>getSerialNumber</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h3 id=posecuritysettings>PoSecuritySettings</h3><p>Concentrate the security settings involved in Calypso Secure Sessions:</p><ul><li>A reference to the SAM resource</li><li>The default KIF</li><li>The default KVC</li><li>The default Key Record Number</li><li>The modification mode</li><li>The ratification mode</li><li>The pin transmission mode</li><li>The default Pin Ciphering Key</li><li>The SV Get Log Read mode</li><li>The SV Negative balance mode</li></ul><p>The fields are populated with default values when the object is instantiated but can be customized to adjust the settings
to the application needs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poSecuritySettings</span><span class=p>.</span><span class=na>getSessionModificationMode</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><p>Secure session settings can be finely tuned with PoSecuritySettings and a set of enums provided by Keyple:</p><h4 id=modification-mode>Modification mode</h4><p>Indicates whether the secure session can be closed and reopened to manage the limitation of the PO buffer memory (session modifications buffer).</p><table><thead><tr><th>ModificationMode</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>ATOMIC</code></strong></td><td>The secure session is atomic.</td></tr><tr><td><strong><code>MULTIPLE</code></strong></td><td>Several secure sessions will be chained (to manage the writing of large amounts of data).</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>PoSecuritySettings</span><span class=w> </span><span class=n>poSecuritySettings</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>new</span><span class=w> </span><span class=n>PoSecuritySettings</span><span class=p>.</span><span class=na>PoSecuritySettingsBuilder</span><span class=p>(</span><span class=n>samResource</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>svGetLogReadMode</span><span class=p>(</span><span class=n>SvSettings</span><span class=p>.</span><span class=na>LogRead</span><span class=p>.</span><span class=na>ALL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h4 id=ratification-mode>Ratification mode</h4><p>The ratification mode defines the behavior of processClosing regarding the ratification process.</p><table><thead><tr><th>RatificationMode</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>CLOSE_RATIFIED</code></strong></td><td>Close session with ratification.</td></tr><tr><td><strong><code>CLOSE_NOT_RATIFIED</code></strong></td><td>Close session without ratification</td></tr></tbody></table><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>PoSecuritySettings</span><span class=w> </span><span class=n>poSecuritySettings</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>new</span><span class=w> </span><span class=n>PoSecuritySettings</span><span class=p>.</span><span class=na>PoSecuritySettingsBuilder</span><span class=p>(</span><span class=n>samResource</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>ratificationMode</span><span class=p>(</span><span class=n>RatificationMode</span><span class=p>.</span><span class=na>CLOSE_RATIFIED</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h4 id=pin-transmission-mode>Pin Transmission Mode</h4><p>Defines the PIN transmission modes: plain or encrypted.</p><table><thead><tr><th>PinTransmissionMode</th></tr></thead><tbody><tr><td><strong><code>PLAIN</code></strong></td></tr><tr><td><strong><code>ENCRYPTED</code></strong></td></tr></tbody></table><h4 id=sv-log-read-mode>SV Log Read mode</h4><p>Specifies whether only one or both SV logs (debit and load) should be read.</p><table><thead><tr><th>LogRead</th></tr></thead><tbody><tr><td><strong><code>SINGLE</code></strong></td></tr><tr><td><strong><code>ALL</code></strong></td></tr></tbody></table><h4 id=sv-negative-balance-mode>SV Negative balance mode</h4><p>Specifies whether POs with a negative SV balance should be accepted.</p><table><thead><tr><th>NegativeBalance</th></tr></thead><tbody><tr><td><strong><code>FORBIDDEN</code></strong></td></tr><tr><td><strong><code>AUTHORIZED</code></strong></td></tr></tbody></table><h2 id=basic-operations>Basic Operations</h2><h3 id=poselection>PoSelection</h3><p>This service provides the means to define a selection case targeting a particular PO (in the ISO 7816-4 sense) with the possibility to collect additional information about the PO before a transaction.</p><p>It integrates with the <strong>Keyple Core Card Selection</strong> service to manage the specific features of Calypso POs:</p><ul><li>Sends optional <em>read</em> and/or <em>select</em> commands to the POs right after the initial card selection.</li><li>Produces a CalypsoPO object from the CardSelectionResponse. The object is filled with the PO identification data from the FCI and the
possible responses to additional APDU commands executed after the selection.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Prepare a Calypso PO selection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CardSelectionsService</span><span class=w> </span><span class=n>cardSelectionsService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CardSelectionsService</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Setting of an AID based selection of a Calypso REV3 PO</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Select the first application matching the selection AID whatever the card communication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// protocol keep the logical channel open after the selection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Calypso selection: configures a PoSelection with all the desired attributes to</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// make the selection and read additional information afterwards</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PoSelection</span><span class=w> </span><span class=n>poSelection</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>PoSelection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>PoSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>cardProtocol</span><span class=p>(</span><span class=n>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=na>ISO_14443_4</span><span class=p>.</span><span class=na>name</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>aidSelector</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>CardSelector</span><span class=p>.</span><span class=na>AidSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>aidToSelect</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>AID</span><span class=p>).</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>invalidatedPo</span><span class=p>(</span><span class=n>PoSelector</span><span class=p>.</span><span class=na>InvalidatedPo</span><span class=p>.</span><span class=na>REJECT</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Prepare the reading order.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poSelection</span><span class=p>.</span><span class=na>prepareReadRecordFile</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>SFI_EnvironmentAndHolder</span><span class=p>,</span><span class=w> </span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>RECORD_NUMBER_1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Add the selection case to the current selection (we could have added other cases</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// here)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>cardSelectionsService</span><span class=p>.</span><span class=na>prepareSelection</span><span class=p>(</span><span class=n>poSelection</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CalypsoPo</span><span class=w> </span><span class=n>calypsoPo</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>CalypsoPo</span><span class=p>)</span><span class=w> </span><span class=n>cardSelectionsService</span><span class=p>.</span><span class=na>processExplicitSelections</span><span class=p>(</span><span class=n>poReader</span><span class=p>).</span><span class=na>getActiveSmartCard</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h2 id=samselection>SamSelection</h2><p>This service provides the means to define a selection case targeting a Calypso SAM.</p><p>It integrates with the <strong>Keyple Core Card Selection</strong> service to manage the specific features of Calypso SAMs:</p><ul><li>optionally executes an unlock command during the selection process.</li><li>provides an instance of Calypso SAM.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CardSelectionsService</span><span class=w> </span><span class=n>samSelection</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CardSelectionsService</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Sam selection parameters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SamSelector</span><span class=w> </span><span class=n>samSelector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SamSelector</span><span class=p>.</span><span class=na>builder</span><span class=p>().</span><span class=na>samRevision</span><span class=p>(</span><span class=n>SamRevision</span><span class=p>.</span><span class=na>C1</span><span class=p>).</span><span class=na>serialNumber</span><span class=p>(</span><span class=s>&#34;.*&#34;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>samSelection</span><span class=p>.</span><span class=na>prepareSelection</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SamSelection</span><span class=p>(</span><span class=n>samSelector</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Sam reader retrieved from registered plugin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CardSelectionsResult</span><span class=w> </span><span class=n>cardSelectionsResult</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>samSelection</span><span class=p>.</span><span class=na>processExplicitSelections</span><span class=p>(</span><span class=n>samReader</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>cardSelectionsResult</span><span class=p>.</span><span class=na>hasActiveSelection</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&#34;Unable to open a logical channel for SAM!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Cast selected card to CalypsoSam</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CalypsoSam</span><span class=w> </span><span class=n>calypsoSam</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=n>CalypsoSam</span><span class=p>)</span><span class=w> </span><span class=n>cardSelectionsResult</span><span class=p>.</span><span class=na>getActiveSmartCard</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h3 id=potransaction>PoTransaction</h3><p>Service providing high-level API to manage transactions with a Calypso PO. The tied CalypsoPO Object is kept and updated at
each step of using this service.</p><p>This service workflow is composed of two steps:</p><ul><li>Prepares the commands to be sent to the PO; several command preparations can be stacked (no communication neither with the PO nor with the SAM).</li><li>Process the prepared commands. Performs all necessary communications with the PO and/or the SAM to carry out the previously prepared operations. CalypsoPo is updated accordingly.</li></ul><p>Note:</p><ul><li>Regarding of commands, the presence of SAM is mandatory or not (mandatory when a <em>Calypso Secure Session</em> is open).</li><li>Pay attention to the number of commands affecting the session modifications buffer, see the <em>ModificationMode</em> setting.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// CardResource allow management of specific card.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// In this example a SAM is available </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CardResource</span><span class=o>&lt;</span><span class=n>CalypsoPo</span><span class=o>&gt;</span><span class=w> </span><span class=n>poResource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CardResource</span><span class=o>&lt;</span><span class=n>CalypsoPo</span><span class=o>&gt;</span><span class=p>(</span><span class=n>poReader</span><span class=p>,</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CardResource</span><span class=o>&lt;</span><span class=n>CalypsoSam</span><span class=o>&gt;</span><span class=w> </span><span class=n>samResource</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>CardResource</span><span class=o>&lt;</span><span class=n>CalypsoPo</span><span class=o>&gt;</span><span class=p>(</span><span class=n>samReader</span><span class=p>,</span><span class=w> </span><span class=n>calypsoSam</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Configure Security settings</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Both Reload and Debit SV logs are requested</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PoSecuritySettings</span><span class=w> </span><span class=n>poSecuritySettings</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>PoSecuritySettings</span><span class=p>.</span><span class=na>PoSecuritySettingsBuilder</span><span class=p>(</span><span class=n>samResource</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>svGetLogReadMode</span><span class=p>(</span><span class=n>SvSettings</span><span class=p>.</span><span class=na>LogRead</span><span class=p>.</span><span class=na>ALL</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PoTransaction</span><span class=w> </span><span class=n>poTransaction</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>PoTransaction</span><span class=p>(</span><span class=n>poResource</span><span class=p>,</span><span class=w> </span><span class=n>poSecuritySettings</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Read the EventLog file at record 1 within the Session Opening</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>prepareReadRecordFile</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>SFI_EventLog</span><span class=p>,</span><span class=w> </span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>RECORD_NUMBER_1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Open a secure session (DEBIT level) and execute the prepared command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>processOpening</span><span class=p>(</span><span class=n>PoTransaction</span><span class=p>.</span><span class=na>SessionSetting</span><span class=p>.</span><span class=na>AccessLevel</span><span class=p>.</span><span class=na>SESSION_LVL_DEBIT</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Get and display the EventLog data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ElementaryFile</span><span class=w> </span><span class=n>efEventLog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getFileBySfi</span><span class=p>(</span><span class=n>CalypsoClassicInfo</span><span class=p>.</span><span class=na>SFI_EventLog</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Example of data parsing</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=n>eventLog</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>ByteArrayUtil</span><span class=p>.</span><span class=na>toHex</span><span class=p>(</span><span class=n>efEventLog</span><span class=p>.</span><span class=na>getData</span><span class=p>().</span><span class=na>getContent</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Prepare a SV Debit (this command could also have been placed before processOpening</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// since it is not followed by any other command)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>prepareSvGet</span><span class=p>(</span><span class=n>SvSettings</span><span class=p>.</span><span class=na>Operation</span><span class=p>.</span><span class=na>DEBIT</span><span class=p>,</span><span class=w> </span><span class=n>SvSettings</span><span class=p>.</span><span class=na>Action</span><span class=p>.</span><span class=na>DO</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// Execute the prepared command</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>poTransaction</span><span class=p>.</span><span class=na>processPoCommands</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Get updated sv balance</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>svBalance</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getSvBalance</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//Get the updated SV last transaction number</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>svLastTNum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>calypsoPo</span><span class=p>.</span><span class=na>getSvLastTNum</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span></code></pre></div><h4 id=secure-session-access-level>Secure Session Access level</h4><p>PoTransaction.processOpening() allows to open a Calypso Secure Session. If commands have been prepared previously, they will be executed.</p><p>Keyple provides an enums to easily configure the Secure Session AccessLevel:</p><table><thead><tr><th>AccessLevel</th><th>Description</th></tr></thead><tbody><tr><td><strong><code>SESSION_LVL_PERSO</code></strong></td><td>Session Access Level used for personalization purposes.</td></tr><tr><td><strong><code>SESSION_LVL_LOAD</code></strong></td><td>Session Access Level used for reloading purposes.</td></tr><tr><td><strong><code>SESSION_LVL_DEBIT</code></strong></td><td>Session Access Level used for validating and debiting purposes.</td></tr></tbody></table><h4 id=transaction-flow-and-calypso-secure-session-management>Transaction flow and Calypso Secure Session management</h4><p>PoTransaction allows you to process a Calypso Secure session in different ways. These are difficult to describe
all in detail but here is an example from which other variants can be obtained.</p><p>A typical Calypso PO transaction flow, for example for ticket validation, could be :</p><ul><li>Execute the selection of a Calypso PO and retrieves the contents of the environment file at the same time.</li><li>Open a secure session and get the contract list</li><li>Get the contract and associated counter</li><li>Decrease the counter, append a new event log</li><li>Close the secure session</li></ul><p>Translated into Keyple Calypso operations, the entire transaction would include the following steps (simplified syntax):</p><ul><li><code>poSelection = new PoSelection(CARD_IAD)</code></li><li><code>poSelection.prepareReadRecordFile(ENVIRONMENT_SFI)</code></li><li>process the poSelection (either explicitly or by default, see the <a href=../../../../archives/docs-1.0/developer-guide/standalone-application/>standalone application</a>) guide</li><li>retrieve CalypsoPo, check its content (environment data)</li><li><code>poTransaction = new PoTransaction(calypsoPo)</code></li><li><code>poTransaction.prepareReadRecordFile(CONTRACT_LIST_SFI)</code></li><li><code>poTransaction.processOpening(DEBIT)</code></li><li>check CalypsoPo content (contract list), decide which contract/counter to read</li><li><code>poTransaction.prepareReadRecordFile(CONTRACT_n)</code></li><li><code>poTransaction.prepareReadRecordFile(COUNTER_n)</code></li><li><code>poTransaction.processPoCommands()</code></li><li>check CalypsoPo content (contract/counter), decide action (decrease counter, append event log)</li><li><code>poTransaction.prepareDecrease(COUNTER_n, X)</code></li><li><code>poTransaction.prepareAppendRecord(EVENT, event_data</code></li><li><code>poTransaction.prepareReleaseChannel()</code></li><li><code>poTransaction.processClosing()</code></li></ul><h2 id=examples>Examples</h2><p>Detailed use case examples can be seen here:</p><ul><li><a href=https://github.com/eclipse-keyple/keyple-java/tree/master/java/example/calypso/src/main/java/org/eclipse/keyple/example/calypso target=_blank rel=noopener>PC</a></li><li><a href=https://github.com/eclipse-keyple/keyple-java/tree/master/java/example/generic/android target=_blank rel=noopener>Android</a></li></ul></article><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=../../../../archives/docs-1.0/developer-guide/distributed-application/ rel=next>Distributed application</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=../../../../archives/docs-1.0/developer-guide/create-plugin/ rel=prev>Create a plugin</a></div></div></div></div><div class=body-footer><p>Last updated on 2025-03-06</p></div><footer class=site-footer><div class=container><div class="row featurette"><div class="col-12 col-sm-4"><p style=color:#fff><b>ECLIPSE LEGAL</b></p><a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a><br><a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a><br><a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a><br><a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a><br><a href=https://www.eclipse.org/legal/>Legal Resources</a><br><a href=https://eclipse.org/security/>Report a Vulnerability</a><br></div><div class="col-12 col-sm-4"><a href=https://www.eclipse.org><img src=../../../../media/eclipse_foundation_logo.svg id=logo-eclipse-foundation></a></div><div class="col-12 col-sm-4"><a href=https://iot.eclipse.org><img src=../../../../media/eclipse_iot_logo.svg id=logo-eclipse-iot></a></div></div></div><p class="powered-by copyright-license-text">息 2019-2026 The Eclipse Keyple速 project. All Rights Reserved.</p><p class=powered-by id=template-info>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby">Hugo Blox Builder</a>  the free, <a href=https://github.com/HugoBlox/hugo-blox-builder>open source</a> website builder that empowers creators.</p></footer></main></div></div></div><div class=page-footer></div><script src=../../../../js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js integrity="sha256-aQmOEF2ZD4NM/xt4hthzREIo/2PFkOX/g01WjxEV7Ys=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=../../../../en/js/wowchemy.min.4001fa6200fc6b06865984a5f4b93700.js></script><script src=../../../../js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><link rel=stylesheet href=https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css><script src=https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js></script><script src=https://d3js.org/d3.v6.min.js></script></body></html>