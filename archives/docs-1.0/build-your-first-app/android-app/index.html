<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.6"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/wowchemy.207e6f30e8fe6b1dbb628a09b889fa60.css><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=../../../../css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=robots content="noindex"><meta name=description content="This guide describes how to start a ticketing application using Keyple middleware and Android NFC plugin to read the content of a Calypso Portable Object."><link rel=alternate hreflang=en-us href=https://keyple.org/archives/docs-1.0/build-your-first-app/android-app/><link rel=canonical href=https://keyple.org/archives/docs-1.0/build-your-first-app/android-app/><link rel=manifest href=../../../../manifest.webmanifest><link rel=icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=../../../../media/icon_hu16db34b3636b127457de39ca2fab620f_9845_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1D87BB"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://keyple.org/media/logo.svg"><meta property="og:type" content="article"><meta property="og:site_name" content="Eclipse Keyple"><meta property="og:url" content="https://keyple.org/archives/docs-1.0/build-your-first-app/android-app/"><meta property="og:title" content="Build your first Android application | Eclipse Keyple"><meta property="og:description" content="This guide describes how to start a ticketing application using Keyple middleware and Android NFC plugin to read the content of a Calypso Portable Object."><meta property="og:image" content="https://keyple.org/media/logo.svg"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2024-05-03T09:28:52+02:00"><title>Build your first Android application | Eclipse Keyple</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=c489aaecd02fd9f44381e33eb5e1804d><script src=../../../../js/wowchemy-init.min.d66af272089c6c0601f1a57edc3bf6ab.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../../../><img src=../../../../media/logo.svg alt="Eclipse Keyple"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple速</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../what-is-keyple/overview/><span>Overview</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/why-trust/><span>Why trust Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=../../../../#adopters><span>Who is using Eclipse Keyple速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/what-is-calypso/><span>What is Calypso速?</span></a>
<a class=dropdown-item href=../../../../what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=../../../../#news><span>News</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../learn/overview><span>Learn</span></a></li><li class=nav-item><a class=nav-link href=../../../../components/overview><span>Components</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Community</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../../adopters-and-testimonials/><span>Adopters & Testimonials</span></a>
<a class=dropdown-item href=../../../../community/licenses/><span>Licenses</span></a>
<a class=dropdown-item href=../../../../community/contributing/><span>Contributing</span></a>
<a class=dropdown-item href=../../../../community/roadmap/><span>Roadmap</span></a>
<a class=dropdown-item href=../../../../community/maintenance/><span>Maintenance</span></a>
<a class=dropdown-item href=../../../../community/changelog/><span>Changelog</span></a>
<a class=dropdown-item href=../../../../statistics/><span>Statistics</span></a>
<a class=dropdown-item href=../../../../project-dashboard/><span>Project dashboard</span></a>
<a class=dropdown-item href="https://sonarcloud.io/organizations/eclipse/projects?search=keyple&amp;sort=-analysis_date"><span>Code quality dashboard</span></a>
<a class=dropdown-item href=https://projects.eclipse.org/projects/iot.keyple/><span>Eclipse Foundation Keyple page</span></a>
<a class=dropdown-item href=https://accounts.eclipse.org/mailing-list/keyple-dev/><span>Mailing list</span></a>
<a class=dropdown-item href=https://github.com/eclipse-keyple/><span>GitHub home repository</span></a>
<a class=dropdown-item href=https://docs.keyple.org/><span>All APIs docs</span></a></div></li><li class=nav-item><a class=nav-link href=../../../../external-resources/><span>External resources</span></a></li><li class=nav-item><a class=nav-link href=../../../../learn/build-your-first-app/><button class='btn btn-info'><i class='fas fa-rocket pr-1' aria-hidden=true></i> <span>START CODING</span></button></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Build your first app
</span><span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Search...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=../../../../archives/></a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/>== Docs 1.x ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/build-your-first-app/>Build your first app</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/build-your-first-app/java-app/>Java</a></li><li class=active><a href=../../../../archives/docs-1.0/build-your-first-app/android-app/>Android</a></li><li><a href=../../../../archives/docs-1.0/build-your-first-app/cpp-app/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/developer-guide/>Developer guides</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/developer-guide/common-concepts/>Common concepts</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/standalone-application/>Standalone application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/distributed-application/>Distributed application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/calypso-application/>Calypso application</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-plugin/>Create a plugin</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/create-extension/>Create an extension</a></li><li><a href=../../../../archives/docs-1.0/developer-guide/upgrade/>Upgrade Keyple</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/api-reference/>API reference</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/api-reference/java-api/>Java</a></li><li><a href=../../../../archives/docs-1.0/api-reference/cpp-api/>C++</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/docs-1.0/architecture/>Architecture</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/docs-1.0/architecture/keyple-global/>Global Solution</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-core/>Keyple Core</a></li><li><a href=../../../../archives/docs-1.0/architecture/keyple-calypso/>Keyple Calypso</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/>== Java 1.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/distributed-systems/>Distributed systems</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/distributed-systems/local/>Local</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/network/>Network</a></li><li><a href=../../../../archives/components-java-1.0/distributed-systems/remote/>Remote</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-java-1.0/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-java-1.0/plugins/nfc/>NFC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/omapi/>OMAPI</a></li><li><a href=../../../../archives/components-java-1.0/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-java-1.0/plugins/stub/>Stub</a></li></ul></div></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/>== C++ 0.x components ==</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/core/>Core</a></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/extensions/>Extensions</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/extensions/calypso/>Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../../archives/components-cpp-0.9/plugins/>Reader plugins</a><ul class="nav docs-sidenav"><li><a href=../../../../archives/components-cpp-0.9/plugins/pcsc/>PC/SC</a></li><li><a href=../../../../archives/components-cpp-0.9/plugins/stub/>Stub</a></li></ul></div></ul></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#overview>Overview</a></li><li><a href=#what-to-we-need-for-this-guide>What to we need for this guide?</a></li></ul></li><li><a href=#integration>Integration</a><ul><li><a href=#application-setup>Application setup</a></li><li><a href=#sdk-integration>SDK Integration</a></li></ul></li><li><a href=#lets-code>Let&rsquo;s code</a><ul><li><a href=#initializing-the-sdk>Initializing the SDK</a></li><li><a href=#retrieve-a-specific-reader>Retrieve a specific reader</a></li><li><a href=#add-observer-to-handle-nfc-events>Add observer to handle NFC events</a></li><li><a href=#activate-a-protocol>Activate a protocol</a></li><li><a href=#deactivate-a-protocol>Deactivate a protocol</a></li><li><a href=#activate-card-detection>Activate Card detection</a></li><li><a href=#deactivate-card-detection>Deactivate Card detection</a></li><li><a href=#handling-a-calypso-po>Handling a Calypso PO</a></li><li><a href=#full-code>Full code</a></li></ul></li><li><a href=#faq>FAQ</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container></div><div class=docs-article-container><h1>Build your first Android application</h1><article class=article-style><div class="alert alert-warning"><div>Version 1.0 of the documentation is no longer actively maintained. The site that you are currently viewing is an archived snapshot. For up-to-date documentation, see the latest version.</div></div><h2 id=introduction>Introduction</h2><h3 id=overview>Overview</h3><p><strong>Since Keyple is supported by the Android operating system, developers can take advantage of this quick and easy way to implement solution to provide SmartCard communication functionalities in their own mobile application.</strong></p><p>For example, Keyple could be used to facilitate the development of a ticketing application based on the use of conteners on a SIM card and relying on <a href=https://developer.android.com/reference/android/se/omapi/package-summary target=_blank rel=noopener>Android SE OMAPI</a>.
Keyple could also be used to develop an application reading SmartCard content through NFC using <a href=https://developer.android.com/guide/topics/connectivity/nfc/advanced-nfc target=_blank rel=noopener>Android NFC</a>.</p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=../../../../media/archive-1.0/android-app/component/Android_App_Overview.png alt loading=lazy data-zoomable></div></div></figure><p>As Keyple request low-level reader access, the key features of Keyple middleware relies on components called <strong>Plugins</strong>. These are the plugins that allow access to the hardware functionality of the terminal by using the native Android SDK or the terminal manufacturer&rsquo;s own custom SDKs.</p><p>This guide will describe how to start a ticketing application using Keyple middleware and Android NFC plugin to read the content of a Calypso SmartCard. As we want to focus on Keyple integration, the Android application architecture will remain the simplest as possible.</p><h3 id=what-to-we-need-for-this-guide>What to we need for this guide?</h3><ul><li>Retail Device with NFC powered by android.nfc library (integrated into standard Android SDK).</li><li>Android OS 19+</li><li>A NFC SmartCard with Calypso PO</li></ul><br><h2 id=integration>Integration</h2><h3 id=application-setup>Application setup</h3><p>Like for any other Android NFC Application, we need to declare items in the application manifest.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;manifest</span> <span class=na>xmlns:android=</span><span class=s>&#34;http://schemas.android.com/apk/res/android&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl>    <span class=nt>&lt;uses-permission</span> <span class=na>android:name=</span><span class=s>&#34;android.permission.NFC&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;uses-feature</span> <span class=na>android:name=</span><span class=s>&#34;android.hardware.nfc&#34;</span> <span class=na>android:required=</span><span class=s>&#34;true&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    ...
</span></span><span class=line><span class=cl><span class=nt>&lt;/manifest&gt;</span>
</span></span></code></pre></div><p>Also make sure your minSdkVersion is at least 19.</p><h3 id=sdk-integration>SDK Integration</h3><h4 id=keyple-core>Keyple Core</h4><p>This high-level API is convenient for developers implementing smart card processing application for terminal interfaced
with smart card readers. Access to the readers is provided by the plugins.</p><p>To use Keyple core API (and in fact, anything keyple&rsquo;s related) import the jar within the gradle dependencies of your
Android application.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>implementation</span> <span class=s2>&#34;org.eclipse.keyple:keyple-java-core:$keyple_version&#34;</span>
</span></span></code></pre></div><p>Please refer to Architecture/Keyle Core</p><h4 id=keyple-plugins>Keyple Plugins</h4><p>There are many Keyple plugins available, the one to use depends on the device and ticketing tools you are aiming to
use.</p><p>To use the NFC plugin simply import it within the gradle dependencies of your Android application.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>implementation</span> <span class=s2>&#34;org.eclipse.keyple:keyple-android-plugin-nfc:$keyple_version&#34;</span>
</span></span></code></pre></div><h4 id=keyple-calypso>Keyple Calypso</h4><p>The Keyple Calypso User API is an extension of the Keyple Core User API to manage Calypso Portable Objects.</p><p>Please refer to Architecture/Keyle Calypso</p><p>To use Keyple Calypso User API simply import the jar within the gradle dependencies of your Android application.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>implementation</span> <span class=s2>&#34;org.eclipse.keyple:keyple-java-calypso:$keyple_version&#34;</span>
</span></span></code></pre></div><br><h2 id=lets-code>Let&rsquo;s code</h2><h3 id=initializing-the-sdk>Initializing the SDK</h3><h4 id=register-a-plugin>Register a plugin</h4><p>In order to setup Keyple, we need to register at least one plugin. Here we register our NFC plugin. To do so, we use the singleton SmartCardService and the plugin Factory. (See plugin development guide to know more about plugins)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* register Android NFC Plugin to the SmartCardService */</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>readerObservationExceptionHandler</span> <span class=p>=</span> <span class=n>ReaderObservationExceptionHandler</span> <span class=p>{</span> <span class=n>pluginName</span><span class=p>,</span> <span class=n>readerName</span><span class=p>,</span> <span class=n>e</span> <span class=o>-&gt;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nc>SmartCardService</span><span class=p>.</span><span class=n>getInstance</span><span class=p>().</span><span class=n>registerPlugin</span><span class=p>(</span><span class=n>AndroidNfcPluginFactory</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>readerObservationExceptionHandler</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>KeypleException</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* do something with it */</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note: Plugins Factory&rsquo;s initialisation could request more steps to execute before passing it to registerPlugin(). It depends on plugins, please check the documentation or usage example of desired plugin.</p><h4 id=unregister-a-plugin>Unregister a plugin</h4><p>Clean resources.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>override</span> <span class=k>fun</span> <span class=nf>onDestroy</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Unregister Android NFC Plugin to the SmartCardService */</span>
</span></span><span class=line><span class=cl>    <span class=nc>SmartCardService</span><span class=p>.</span><span class=n>getInstance</span><span class=p>().</span><span class=n>unregisterPlugin</span><span class=p>(</span><span class=nc>AndroidNfcPlugin</span><span class=p>.</span><span class=n>PLUGIN_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>reader</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>    <span class=k>super</span><span class=p>.</span><span class=n>onDestroy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=retrieve-a-specific-reader>Retrieve a specific reader</h3><p>With the plugin registered we can retrieve all instances of the component mapping the SmartCard readers. Here we want to retrieve the NFC reader.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>//We keep a reference to the reader for later use
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>private</span> <span class=k>lateinit</span> <span class=k>var</span> <span class=py>reader</span><span class=p>:</span> <span class=n>AndroidNfcReader</span>
</span></span><span class=line><span class=cl><span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=c1>//PLUGIN_NAME and READER_NAME are constants provided by the used Keyple plugin 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>reader</span> <span class=p>=</span> <span class=n>plugin</span><span class=p>.</span><span class=n>readers</span><span class=p>[</span><span class=nc>AndroidNfcReader</span><span class=p>.</span><span class=n>READER_NAME</span><span class=p>]</span> <span class=k>as</span> <span class=n>AndroidNfcReader</span>
</span></span></code></pre></div><h3 id=add-observer-to-handle-nfc-events>Add observer to handle NFC events</h3><p>When native NFC is activated on an Android device, the OS dispatches insertion events occurring in the NFC detection field. In our application, we need detect it in order to proceed to exchanges with the SmartCard.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=c1>//To keep it simple we choose to have our MainActivity implementing ObservableReader.ReaderObserver 
</span></span></span><span class=line><span class=cl><span class=c1>//interface. 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>        
</span></span><span class=line><span class=cl>    <span class=n>reader</span><span class=p>.</span><span class=n>addObserver</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Belongs to ObservableReader.ReaderObserver
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//NFC Reader events will be received here.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//this method is not triggered in UI thread
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>update</span><span class=p>(</span><span class=n>event</span><span class=p>:</span> <span class=n>ReaderEvent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=n>eventType</span> <span class=o>==</span> <span class=nc>ReaderEvent</span><span class=p>.</span><span class=nc>EventType</span><span class=p>.</span><span class=n>CARD_INSERTED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=c1>//We&#39;ll select PO when SmartCard is presented in field
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>//Method handlePo is described below
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>handlePo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=activate-a-protocol>Activate a protocol</h3><p>Before starting to read a NFC tag, you must activate the protocol in which you wish to detect it.
If you do not activate any protocol, no card will be detected by the Keyple library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>      <span class=c1>// with this protocol settings we activate the nfc for ISO1443_4 protocol
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>reader</span><span class=p>.</span><span class=n>activateProtocol</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nc>AndroidNfcProtocolSettings</span><span class=p>.</span><span class=n>getSetting</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=deactivate-a-protocol>Deactivate a protocol</h3><p>When your are done with your NFC operations, you can deactivate the NFC protocol :</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onDestroy</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>        <span class=c1>//Deactivate nfc for ISO1443_4 protocol
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>reader</span><span class=o>?.</span><span class=n>deactivateProtocol</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onDestroy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now we have an access to our NFC Reader, we can activate Card Detection.</p><h3 id=activate-card-detection>Activate Card detection</h3><p>We will start detection as soon as our application comes in foreground and stop when application go background.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onResume</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onResume</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//We choose to continue waiting for a new card persentation
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>it</span><span class=p>.</span><span class=n>startCardDetection</span><span class=p>(</span><span class=nc>ObservableReader</span><span class=p>.</span><span class=nc>PollingMode</span><span class=p>.</span><span class=n>REPEATING</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=deactivate-card-detection>Deactivate Card detection</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onPause</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>it</span><span class=p>.</span><span class=n>stopCardDetection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onPause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now we can detect when a SmartCard is presented in the field, we can proceed to card application selection and data reading.</p><h3 id=handling-a-calypso-po>Handling a Calypso PO</h3><h4 id=calypso-selection-api>Calypso Selection API</h4><p>With Keyple, PO selection and FCI retrieving can be done using only Keyple Core, but Keyple Calypso API provides specific tools to handle Calypso POs and make the process a bit more simple.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>fun</span> <span class=nf>handlePo</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>//check if card is in the NFC field
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=p>(</span><span class=k>it</span><span class=p>.</span><span class=n>isCardPresent</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>//Instanciate class handling card selection service 
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>val</span> <span class=py>cardSelectionsService</span> <span class=p>=</span> <span class=n>CardSelectionsService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=c1>//We only want to select the PO so we choose to close communication channel once 
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>//selection is done
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>prepareReleaseChannel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>//We build a selection request managing specific characteristics of Calypso POs
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>val</span> <span class=py>poSelection</span> <span class=p>=</span> <span class=n>PoSelection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>PoSelector</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>builder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//Smarcard standard protocol
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=p>.</span><span class=n>cardProtocol</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>.</span><span class=n>aidSelector</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=n>builder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                            <span class=p>.</span><span class=n>aidToSelect</span><span class=p>(</span><span class=n>YOUR_AID</span><span class=p>)</span>  <span class=c1>//Set the AID of your Calypso PO
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=c1>//indicates how to carry out the file occurrence in accordance with 
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=c1>//ISO7816-4
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=p>.</span><span class=n>fileOccurrence</span><span class=p>(</span><span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=nc>FileOccurrence</span><span class=p>.</span><span class=n>FIRST</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=c1>//indicates which template is expected in accordance with ISO7816-4
</span></span></span><span class=line><span class=cl><span class=c1></span>                            <span class=p>.</span><span class=n>fileControlInformation</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                                <span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=nc>FileControlInformation</span><span class=p>.</span><span class=n>FCI</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>.</span><span class=n>build</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>).</span><span class=n>build</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>prepareSelection</span><span class=p>(</span><span class=n>poSelection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1>//Proceed to selection using the reader
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>val</span> <span class=py>selectionResult</span> <span class=p>=</span> <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>processExplicitSelections</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>runOnUiThread</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>//We check the selection result and read the FCI
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>if</span><span class=p>(</span><span class=n>selectionResult</span><span class=p>.</span><span class=n>hasActiveSelection</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>                    <span class=k>val</span> <span class=py>matchedSmartCard</span> <span class=p>=</span> <span class=n>selectionResult</span><span class=p>.</span><span class=n>activeSmartCard</span>
</span></span><span class=line><span class=cl>                    <span class=k>val</span> <span class=py>fci</span> <span class=p>=</span> <span class=n>matchedSmartCard</span><span class=p>.</span><span class=n>fciBytes</span>
</span></span><span class=line><span class=cl>                    <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Selected, Fci %s&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>fci</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_LONG</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                        <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Not selected&#34;</span><span class=p>),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now we&rsquo;ve seen we can select our PO we can retrieve more data from it.</p><h4 id=reading-environment-and-usage>Reading Environment and usage</h4><p>In the below example we&rsquo;ll read Environment and Usage data of an Hoplink container.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=c1>//Data related to Hoplink
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>val</span> <span class=py>poAid</span><span class=p>=</span> <span class=s2>&#34;A000000291A000000191&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sfiHoplinkEFEnvironment</span> <span class=p>=</span> <span class=m>0x14</span><span class=p>.</span><span class=n>toByte</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sfiHoplinkEFUsage</span> <span class=p>=</span> <span class=m>0x1A</span><span class=p>.</span><span class=n>toByte</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>fun</span> <span class=nf>handlePo</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>        <span class=c1>//Prepare the reading order. We&#39;ll read the first record of the EF
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//specified by its SFI. This reading will be done within explicit selection.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>poSelection</span><span class=p>.</span><span class=n>prepareReadRecordFile</span><span class=p>(</span><span class=n>sfiHoplinkEFEnvironment</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>poSelection</span><span class=p>.</span><span class=n>prepareReadRecordFile</span><span class=p>(</span><span class=n>sfiHoplinkEFUsage</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>..</span><span class=p>.</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>//Hoplink is a Calypso PO, we can cast the SmartCard
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>//with CalypsoPo class, representing the PO content.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>val</span> <span class=py>calypsoPO</span> <span class=p>=</span> <span class=n>selectionResult</span><span class=p>.</span><span class=n>activeSmartCard</span> <span class=k>as</span> <span class=n>CalypsoPo</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>environment</span> <span class=p>=</span> <span class=n>calypsoPO</span><span class=p>.</span><span class=n>getFileBySfi</span><span class=p>(</span><span class=n>sfiHoplinkEFEnvironment</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>val</span> <span class=py>usage</span> <span class=p>=</span> <span class=n>calypsoPO</span><span class=p>.</span><span class=n>getFileBySfi</span><span class=p>(</span><span class=n>sfiHoplinkEFUsage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Environment %s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>environment</span><span class=p>.</span><span class=k>data</span><span class=p>.</span><span class=n>content</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Usage %s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>usage</span><span class=p>.</span><span class=k>data</span><span class=p>.</span><span class=n>content</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h3 id=full-code>Full code</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;manifest</span> <span class=na>xmlns:android=</span><span class=s>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>package=</span><span class=s>&#34;org.eclipse.keyple.android.quickstart&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;uses-permission</span> <span class=na>android:name=</span><span class=s>&#34;android.permission.NFC&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;uses-feature</span>
</span></span><span class=line><span class=cl>        <span class=na>android:name=</span><span class=s>&#34;android.hardware.nfc&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:required=</span><span class=s>&#34;true&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;application</span>
</span></span><span class=line><span class=cl>        <span class=na>android:allowBackup=</span><span class=s>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:screenOrientation=</span><span class=s>&#34;portrait&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:icon=</span><span class=s>&#34;@mipmap/ic_launcher&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:label=</span><span class=s>&#34;@string/app_name&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:roundIcon=</span><span class=s>&#34;@mipmap/ic_launcher_round&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:supportsRtl=</span><span class=s>&#34;true&#34;</span>
</span></span><span class=line><span class=cl>        <span class=na>android:theme=</span><span class=s>&#34;@style/AppTheme&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;activity</span> <span class=na>android:name=</span><span class=s>&#34;.MainActivity&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;intent-filter&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&#34;android.intent.action.MAIN&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&#34;android.intent.category.LAUNCHER&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/intent-filter&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/activity&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/application&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/manifest&gt;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-kotlin data-lang=kotlin><span class=line><span class=cl><span class=k>class</span> <span class=nc>MainActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=nc>ObservableReader</span><span class=p>.</span><span class=n>ReaderObserver</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=k>var</span> <span class=py>reader</span><span class=p>:</span> <span class=n>AndroidNfcReader</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>poAid</span><span class=p>=</span> <span class=s2>&#34;A000000291A000000191&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sfiHoplinkEFEnvironment</span> <span class=p>=</span> <span class=m>0x14</span><span class=p>.</span><span class=n>toByte</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>val</span> <span class=py>sfiHoplinkEFUsage</span> <span class=p>=</span> <span class=m>0x1A</span><span class=p>.</span><span class=n>toByte</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>setContentView</span><span class=p>(</span><span class=nc>R</span><span class=p>.</span><span class=n>layout</span><span class=p>.</span><span class=n>activity_main</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>readerObservationExceptionHandler</span> <span class=p>=</span> <span class=n>ReaderObservationExceptionHandler</span> <span class=p>{</span> <span class=n>pluginName</span><span class=p>,</span> <span class=n>readerName</span><span class=p>,</span> <span class=n>e</span> <span class=o>-&gt;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>plugin</span> <span class=p>=</span> <span class=nc>SmartCardService</span><span class=p>.</span><span class=n>getInstance</span><span class=p>().</span><span class=n>registerPlugin</span><span class=p>(</span><span class=n>AndroidNfcPluginFactory</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>readerObservationExceptionHandler</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>val</span> <span class=py>reader</span> <span class=p>=</span> <span class=n>plugin</span><span class=p>.</span><span class=n>readers</span><span class=p>[</span><span class=nc>AndroidNfcReader</span><span class=p>.</span><span class=n>READER_NAME</span><span class=p>]</span> <span class=k>as</span> <span class=n>AndroidNfcReader</span>
</span></span><span class=line><span class=cl>            <span class=n>reader</span><span class=p>.</span><span class=n>addObserver</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>reader</span><span class=p>.</span><span class=n>activateProtocol</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=nc>AndroidNfcProtocolSettings</span><span class=p>.</span><span class=n>getSetting</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=p>.</span><span class=n>reader</span> <span class=p>=</span> <span class=n>reader</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>catch</span> <span class=p>(</span><span class=n>e</span><span class=p>:</span> <span class=n>KeypleException</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nc>Timber</span><span class=p>.</span><span class=n>e</span><span class=p>(</span><span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Error: %s&#34;</span><span class=p>,</span> <span class=n>e</span><span class=p>.</span><span class=n>message</span><span class=p>),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_LONG</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onResume</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onResume</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>it</span><span class=p>.</span><span class=n>startCardDetection</span><span class=p>(</span><span class=nc>ObservableReader</span><span class=p>.</span><span class=nc>PollingMode</span><span class=p>.</span><span class=n>SINGLESHOT</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Hunt enabled&#34;</span><span class=p>),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onPause</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>it</span><span class=p>.</span><span class=n>stopCardDetection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onPause</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>onDestroy</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Deactivate nfc for ISO1443_4 protocol */</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>deactivateProtocol</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=cm>/* Unregister Android NFC Plugin to the SmartCardService */</span>
</span></span><span class=line><span class=cl>        <span class=nc>SmartCardService</span><span class=p>.</span><span class=n>getInstance</span><span class=p>().</span><span class=n>unregisterPlugin</span><span class=p>(</span><span class=nc>AndroidNfcPlugin</span><span class=p>.</span><span class=n>PLUGIN_NAME</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span> <span class=p>=</span> <span class=k>null</span>
</span></span><span class=line><span class=cl>        <span class=k>super</span><span class=p>.</span><span class=n>onDestroy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>override</span> <span class=k>fun</span> <span class=nf>update</span><span class=p>(</span><span class=n>event</span><span class=p>:</span> <span class=n>ReaderEvent</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nc>Timber</span><span class=p>.</span><span class=n>d</span><span class=p>(</span><span class=s2>&#34;Event: %s&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>.</span><span class=n>eventType</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>runOnUiThread</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Event: %s&#34;</span><span class=p>,</span> <span class=n>event</span><span class=p>.</span><span class=n>eventType</span><span class=p>.</span><span class=n>name</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=n>eventType</span> <span class=o>==</span> <span class=nc>ReaderEvent</span><span class=p>.</span><span class=nc>EventType</span><span class=p>.</span><span class=n>CARD_INSERTED</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=n>handlePo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//With Calypso API
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>private</span> <span class=k>fun</span> <span class=nf>handlePo</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=n>reader</span><span class=o>?.</span><span class=n>let</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=k>it</span><span class=p>.</span><span class=n>isCardPresent</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=k>val</span> <span class=py>cardSelectionsService</span> <span class=p>=</span> <span class=n>CardSelectionsService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>prepareReleaseChannel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>val</span> <span class=py>poSelection</span> <span class=p>=</span> <span class=n>PoSelection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=n>PoSelector</span>
</span></span><span class=line><span class=cl>                                <span class=p>.</span><span class=n>builder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                                <span class=p>.</span><span class=n>cardProtocol</span><span class=p>(</span><span class=nc>ContactlessCardCommonProtocols</span><span class=p>.</span><span class=n>ISO_14443_4</span><span class=p>.</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=p>.</span><span class=n>aidSelector</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                                        <span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=n>builder</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                                                <span class=p>.</span><span class=n>aidToSelect</span><span class=p>(</span><span class=n>poAid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                                <span class=p>.</span><span class=n>fileOccurrence</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                                                    <span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=nc>FileOccurrence</span><span class=p>.</span><span class=n>FIRST</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                                <span class=p>.</span><span class=n>fileControlInformation</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                                                    <span class=nc>CardSelector</span><span class=p>.</span><span class=nc>AidSelector</span><span class=p>.</span><span class=nc>FileControlInformation</span><span class=p>.</span><span class=n>FCI</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                                <span class=p>.</span><span class=n>build</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                                <span class=p>).</span><span class=n>build</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>prepareSelection</span><span class=p>(</span><span class=n>poSelection</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>//Prepare the reading order. We&#39;ll read the first record of the EF
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>//specified by his SFI. This reading will be done with selection.
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>poSelection</span><span class=p>.</span><span class=n>prepareReadRecordFile</span><span class=p>(</span><span class=n>sfiHoplinkEFEnvironment</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>poSelection</span><span class=p>.</span><span class=n>prepareReadRecordFile</span><span class=p>(</span><span class=n>sfiHoplinkEFUsage</span><span class=p>,</span> <span class=m>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1>//Selection and file reading will be done here
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>val</span> <span class=py>selectionResult</span> <span class=p>=</span> <span class=n>cardSelectionsService</span><span class=p>.</span><span class=n>processExplicitSelections</span><span class=p>(</span><span class=k>it</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>runOnUiThread</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span><span class=p>(</span><span class=n>selectionResult</span><span class=p>.</span><span class=n>hasActiveSelection</span><span class=p>()){</span>
</span></span><span class=line><span class=cl>                        <span class=k>val</span> <span class=py>matchedSmartCard</span> <span class=p>=</span> <span class=n>selectionResult</span><span class=p>.</span><span class=n>activeSmartCard</span>
</span></span><span class=line><span class=cl>                        <span class=k>val</span> <span class=py>fci</span> <span class=p>=</span> <span class=n>matchedSmartCard</span><span class=p>.</span><span class=n>fciBytes</span>
</span></span><span class=line><span class=cl>                        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Selected, Fci %s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>fci</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                        <span class=c1>//Hoplink is a Calypso PO, we can cast the SmartCard
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=c1>//with CalypsoPo class, representing the PO content.
</span></span></span><span class=line><span class=cl><span class=c1></span>                        <span class=k>val</span> <span class=py>calypsoPO</span> <span class=p>=</span> <span class=n>selectionResult</span><span class=p>.</span><span class=n>activeSmartCard</span> <span class=k>as</span> <span class=n>CalypsoPo</span>
</span></span><span class=line><span class=cl>                        <span class=k>val</span> <span class=py>environment</span> <span class=p>=</span> <span class=n>calypsoPO</span><span class=p>.</span><span class=n>getFileBySfi</span><span class=p>(</span><span class=n>sfiHoplinkEFEnvironment</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>val</span> <span class=py>usage</span> <span class=p>=</span> <span class=n>calypsoPO</span><span class=p>.</span><span class=n>getFileBySfi</span><span class=p>(</span><span class=n>sfiHoplinkEFUsage</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Environment %s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>environment</span><span class=p>.</span><span class=k>data</span><span class=p>.</span><span class=n>content</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Usage %s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=nc>ByteArrayUtil</span><span class=p>.</span><span class=n>toHex</span><span class=p>(</span><span class=n>usage</span><span class=p>.</span><span class=k>data</span><span class=p>.</span><span class=n>content</span><span class=p>)),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nc>Toast</span><span class=p>.</span><span class=n>makeText</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=nc>String</span><span class=p>.</span><span class=n>format</span><span class=p>(</span><span class=s2>&#34;Not selected&#34;</span><span class=p>),</span> <span class=nc>Toast</span><span class=p>.</span><span class=n>LENGTH_SHORT</span><span class=p>).</span><span class=n>show</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><br><h2 id=faq>FAQ</h2><p><strong>How to fix &ldquo;More than one file was found with OS independent path &lsquo;META-INF/NOTICE.md&rsquo;.&rdquo;</strong></p><p>Add lines below to your :app build.gradle file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>android</span><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>packagingOptions</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>exclude</span> <span class=s1>&#39;META-INF/NOTICE.md&#39;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><strong>Where can I see more examples</strong></p><p>Android native plugins are provided with example applications. Check it to see more use cases: <a href=https://github.com/eclipse-keyple/keyple-java/tree/master/java/example target=_blank rel=noopener>Examples</a></p></article><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=../../../../archives/docs-1.0/build-your-first-app/java-app/ rel=next>Build your first Java application</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=../../../../archives/docs-1.0/build-your-first-app/cpp-app/ rel=prev>Build your first C++ application</a></div></div></div></div><div class=body-footer><p>Last updated on 2024-05-03</p></div><footer class=site-footer><div class=container><div class="row featurette"><div class="col-12 col-sm-4"><p style=color:#fff><b>ECLIPSE LEGAL</b></p><a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a><br><a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a><br><a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a><br><a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a><br><a href=https://www.eclipse.org/legal/>Legal Resources</a><br><a href=https://eclipse.org/security/>Report a Vulnerability</a><br></div><div class="col-12 col-sm-4"><a href=https://www.eclipse.org><img src=../../../../media/eclipse_foundation_logo.svg id=logo-eclipse-foundation></a></div><div class="col-12 col-sm-4"><a href=https://iot.eclipse.org><img src=../../../../media/eclipse_iot_logo.svg id=logo-eclipse-iot></a></div></div></div><p class="powered-by copyright-license-text">息 2019-2025 The Eclipse Keyple速 project. All Rights Reserved.</p><p class=powered-by id=template-info>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby">Hugo Blox Builder</a>  the free, <a href=https://github.com/HugoBlox/hugo-blox-builder>open source</a> website builder that empowers creators.</p></footer></main></div></div></div><div class=page-footer></div><script src=../../../../js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js integrity="sha256-aQmOEF2ZD4NM/xt4hthzREIo/2PFkOX/g01WjxEV7Ys=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=../../../../en/js/wowchemy.min.49526edd02879362218a9de42c3735af.js></script><script src=../../../../js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><link rel=stylesheet href=https://cdn.datatables.net/1.10.22/css/dataTables.bootstrap4.min.css><script src=https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js></script><script src=https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js></script><script src=https://d3js.org/d3.v6.min.js></script></body></html>